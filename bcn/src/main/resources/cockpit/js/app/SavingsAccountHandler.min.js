"use strict";var currentChangedFil="ALL";var savings_account_submit_date;var countOfSavingsAccountsApplicationTableIterations;var savingsAccountTransactionBody;var savingsAccountNewAcBalance;var savingsAccountPrevAcBalance;var savingsAccountTransactionDate;var savingsAccountId;var SavingsAccountHandler=function(){countOfSavingsAccountsApplicationTableIterations=0;this.forReporting=false;SavingsAccountHandler.self=this;savingsAccountList.addDataModelChangedEventListenerCallback(SavingsAccountHandler.prototype.dataModelChanged);savingsAccountList.addEntityChangedEventListenerCallback(SavingsAccountHandler.prototype.entityChanged);$("#savingsAccountCloseFormCloseBtn").on("click touch",SavingsAccountHandler.self.handleSavingsAccountClosingAction);$("#savingsAccountCloseFormWithdrawToZeroBtn").on("click",SavingsAccountHandler.self.handleSavingsAccountWithdrawToZeroAction);$("#savingsAccountCloseDepositWithdrawFormCancelBtn").on("click touch",SavingsAccountHandler.self.getAllForCloseDepositAndWithdraw);$("#savingsAccountWithdrawFormWithdrawBtn").on("click",SavingsAccountHandler.self.handleSavingsAccountWithdrawAction);$("#SavingsAccountReportTypeForm select").on("input",SavingsAccountHandler.prototype.genericSavingAccountReportSelectHandler);$("#savingsAccountDepositFormDepositBtn").on("click",SavingsAccountHandler.self.handleSavingsAccountDepositAction);$("#savingsAccountCloseDepositWithdrawFormCloseBtn").click(function(){SavingsAccountHandler.self.handleSavingsAccountCloseAccountOption()});$("#savingsAccountCloseDepositWithdrawFormWithdrawBtn").click(function(){SavingsAccountHandler.self.handleSavingsAccountWithdrawAccountOption()});$("#savingsAccountCloseDepositWithdrawFormDepositBtn").click(function(){SavingsAccountHandler.self.handleSavingsAccountDepositAccountOption()});SavingsAccountHandler.self.goBackHandler=null};SavingsAccountHandler.ROOT_PATH="/savingsaccount/v1d/";SavingsAccountHandler.APPLICATION_TITLES={clientName:"Name",accountNo:"Account",status:"Status",submitDate:"Submission Date",interestRate:"Rate",balance:"Balance"};SavingsAccountHandler.ALL_ACCOUNTS_TITLES={clientName:"Name",accountNo:"Account",status:"Status",interestRate:"Rate",balance:"Balance"};SavingsAccountHandler.CUSTOMISED_ACCOUNT_TITLES={clientName:"Name",accountNo:"Account",status:"Status",interestRate:"Rate",balance:"Balance",accountId:"Account ID",awamoId:"Awamo ID"};SavingsAccountHandler.CLIENT_TITLES={fullname:"Name",gender:"Sex",birthdate:"Birth date",submitDate:"Registration",phone1:"Phone"};SavingsAccountHandler.TRANSACTION_TITLES={transactionDate:"Date",amount:"Amount",transactionType:"Type",balance:"Balance"};SavingsAccountHandler.prototype.getApplications=function(){SavingsAccountHandler.forReporting=false;addHistory("Savings Account Applications","#savingsAccountApplications",getSidebarSubitemSelector("actionRequired","SavingsAccount","getApplications"));currentTable="savingsAccountApplications";SavingsAccountHandler.self.previousPage=SavingsAccountHandler.self.getApplications;SavingsAccountHandler.self.displaySavingsAccountApplications()};SavingsAccountHandler.prototype.getAll=function(){SavingsAccountHandler.forReporting=false;addHistory("All Savings Accounts","#savingsAccounts",getSidebarSubitemSelector("reporting","SavingsAccount","getAll"));currentTable="allSavingsAccounts";SavingsAccountHandler.self.previousPage=SavingsAccountHandler.self.getAll;SavingsAccountHandler.self.displayAllSavingsAccounts()};SavingsAccountHandler.prototype.getAllForReporting=function(){SavingsAccountHandler.forReporting=true;addHistory("Reporting All Accounts","#reportingSavingsAccountAllAccounts",getSidebarSubitemSelector("reporting","SavingsAccount","getAllForReporting"));currentTable="allSavingsAccounts";SavingsAccountHandler.self.previousPage=SavingsAccountHandler.self.getAllForReporting;SavingsAccountHandler.self.displayAllSavingsAccounts()};SavingsAccountHandler.prototype.getAllForCloseDepositAndWithdraw=function(){addHistory("Savings Accounts All Accounts","#bankingServicesSavingsAccountAllAccounts",getSidebarSubitemSelector("savingsAccountMainMenu","SavingsAccount","getAllForCloseDepositAndWithdraw"));currentTable="allSavingsAccountsCustom";SavingsAccountHandler.self.previousPage=SavingsAccountHandler.self.getAllForCloseDepositAndWithdraw;SavingsAccountHandler.self.displayAllSavingsAccountsForCloseDepositWithdraw()};SavingsAccountHandler.prototype.showAllClientsForSavingsAccountApplication=function(){addHistory("Savings Accounts All Clients","#bankingServicesSavingsAccountAllClients",getSidebarSubitemSelector("savingsAccountMainMenu","SavingsAccount","showAllClientsForSavingsAccountApplication"));currentTable="allClients";SavingsAccountHandler.self.previousPage=SavingsAccountHandler.self.showAllClientsForSavingsAccountApplication;SavingsAccountHandler.self.displayAllClientsForSavingsAccountApplication()};SavingsAccountHandler.prototype.displayAllClientsForSavingsAccountApplication=function(){ClientHandler.self.currentClient=null;initDefaultContent("Select Client For Savings Account Application");var n=clientList.getEntities();var q=getDefaultRowContainer(SavingsAccountHandler.CLIENT_TITLES,true,"bankingSvcsSavingsAcClientsTable");var p=q.parent();for(var g=0;g<n.length;g++){var r={};for(var o in SavingsAccountHandler.CLIENT_TITLES){var f=n[g][o];if("birthdate"===o||"submitDate"===o){f=formatDate(f)}if("account"===o){var b=savingsAccountList.getByClient(n[g]["awamoId"]);var m=b.length;if(m>0){var l=0;for(var d=0;d<m;d++){var a=b[d];l=l+a.balance}f=currencyCode+" "+formatCurrency(l)}else{f=currencyCode+" "+0}}if("loan"===o){var h=loanList.getByClient(n[g]["awamoId"]);var m=h.length;if(m>0){var l=0;for(var d=0;d<m;d++){var e=h[d];if(e.status==="ACTIVE"){l=l+e.principal}}f=currencyCode+" "+formatCurrency(l)}else{f=currencyCode+" "+0}}if(f===" "){f="n.a."}r[o]=f}addRow(q,r,n[g],SavingsAccountHandler.self.newSavingsAccountApplicationClientRowClickHandler,n[g].accountId)}var k=getDefaultTableSorter();k.headers={3:{sorter:"awamoDateSorter"},4:{sorter:"awamoDateSorter"}};initialize_datatable(p);var c=document.getElementById("defaultTableContainer").getElementsByTagName("table");for(var g=0;g<c.length;g++){c[g].style.textAlign="right"}$("#tableTotal").text(n.length);showContent($("#tableTotalSum"));showContent($("#emailLoanReportDiv"));$("#hiddenPrintedTitle").val("Clients Report")};SavingsAccountHandler.prototype.newSavingsAccountApplicationClientRowClickHandler=function(){SavingsAccountHandler.self.newSavingsAccountApplicationClientManageShowApplicationForm($(this).data("object"))};SavingsAccountHandler.prototype.newSavingsAccountApplicationClientManageShowApplicationForm=function(a){if(!exists(a)){return}ClientHandler.self.client=a;initDefaultContent("Create Savings Account");SavingsAccountHandler.self.displayNewSavingsAccountApplicationForClient(a);document.getElementById("newSavingsAccountFormSubmitBtn").disabled=false;document.getElementById("newSavingsAccountFormCancelBtn").disabled=false;$("#newSavingsAccountFormSubmitBtn").off("click touch");$("#newSavingsAccountFormSubmitBtn").on("click touch",SavingsAccountHandler.self.submitSavingsAccountApplicationHandler);$("#newSavingsAccountFormCancelBtn").off("click touch");$("#newSavingsAccountFormCancelBtn").on("click touch",SavingsAccountHandler.self.cancelSavingsAccountApplicationHandler);showContent($("#newSavingsAccountDiv"))};SavingsAccountHandler.prototype.cancelSavingsAccountApplicationHandler=function(){addHistory("All Clients","#savingsAccounts",getSidebarSubitemSelector("savingsAccount","SavingsAccount","showAllClientsForSavingsAccountApplication"));currentTable="allClients";SavingsAccountHandler.self.previousPage=SavingsAccountHandler.self.showAllClientsForSavingsAccountApplication;SavingsAccountHandler.self.displayAllClientsForSavingsAccountApplication()};SavingsAccountHandler.prototype.submitSavingsAccountApplicationHandler=function(g){g.preventDefault();if(validateForm($("#newSavingsAccountForm"))){var i=$("#newSavingsAccountFormInterestRate").val();var c=$("#newSavingsAccountFormInterestRate").val().replace(/\./g,"");var d=$("#newSavingsAccountFormLastName").val().toUpperCase()+", "+$("#newSavingsAccountFormFirstName").val();console.log("test result : "+(!isNaN(parseFloat(i))&&isFinite(i)));var h=true;if((!isNaN(parseFloat(i))&&isFinite(i))){var j=unformatPercentage(i);if($("#newSavingsAccountFormWithInterestYes").is(":checked")&&(!(parseFloat(i)>0)||!(parseFloat(i)<=100))){showContent($("#newSavingsAccountDiv"));showAlertMessage("Please check the value of the interest rate, it should be greater than 0 and less than 100",AlertTypes.warning);h=false}else{if($("#newSavingsAccountFormWithInterestNo").is(":checked")){h=true}}if(h){if($("#newSavingsAccountFormWithInterestNo").is(":checked")){i=0}else{if($("#newSavingsAccountFormWithInterestYes").is(":checked")){i=unformatCurrency(i)}}var a=getAuthenticationHeader();var b=SavingsAccountHandler.ROOT_PATH;var f='{"savingsAccountType":"INDIVIDUAL","interestRate":"'+j+'","balance":"0","status":"SUBMITTED","submitDate":"'+Date.now()+'","awamoId":"'+$("#newSavingsAccountFormAwamoId").val()+'"}';$.ajax({url:host+b,data:f,dataType:"json",contentType:"application/json; charset=utf-8",headers:a,type:"POST",beforeSend:function(){document.getElementById("newSavingsAccountFormSubmitBtn").disabled=true;document.getElementById("newSavingsAccountFormCancelBtn").disabled=true;showLoader()},success:function(e){$("#newSavingsAccountFormInterestRate").val("0");document.getElementById("newSavingsAccountFormSubmitBtn").disabled=false;document.getElementById("newSavingsAccountFormCancelBtn").disabled=false;SavingsAccountHandler.prototype.createLocalSavingsAccountApplicationObject(e.accountNo,e.accountId,j,$("#newSavingsAccountFormAwamoId").val(),d);SavingsAccountHandler.self.displayAllClientsForSavingsAccountApplication();hideLoader();showAlertMessage("Savings account application submited successfully",AlertTypes.success)},complete:function(){$("#newSavingsAccountFormInterestRate").val("0");document.getElementById("newSavingsAccountFormSubmitBtn").disabled=false;document.getElementById("newSavingsAccountFormCancelBtn").disabled=false;hideLoader()}}).fail(function(e){hideLoader();showAlertMessage("Savings account application failed and not submitted",AlertTypes.danger);document.getElementById("newSavingsAccountFormSubmitBtn").disabled=false;document.getElementById("newSavingsAccountFormCancelBtn").disabled=false;$("#newSavingsAccountFormInterestRate").val("0");showContent($("#newSavingsAccountDiv"))})}}else{showAlertMessage("Please check the value of the interest rate, it should be a digit greater than 0 and less than 100",AlertTypes.danger)}}else{showAlertMessage("Please ensure that all the fields are filled in correctly",AlertTypes.danger)}};SavingsAccountHandler.prototype.createLocalSavingsAccountApplicationObject=function(e,f,c,b,d){var a=new Object();a.clientName=d;a.accountNo=e;a.accountId=f;a.status="SUBMITTED";console.log("interest rate : "+c);a.interestRate=c;a.awamoId=b;a.balance="0";savingsAccountList.store(a)};SavingsAccountHandler.prototype.displayNewSavingsAccountApplicationForClient=function(a){document.getElementById("newSavingsAccountFormClientImageID").src="images/personPlaceholderNoText.png";$("#newSavingsAccountDiv .panel-heading").text("Create Savings Account For "+a.fullname);$("#newSavingsAccountFormFirstName").val("");$("#newSavingsAccountFormFirstName").val(a.firstname);$("#newSavingsAccountFormMiddleName").val(a.middlename);$("#newSavingsAccountFormLastName").val(a.lastname);$("#newSavingsAccountFormBirthdate").val(formatDate(a.birthdate)+" ("+a.age+" years)");$("#newSavingsAccountFormNationality").val(a.nationality);$("#newSavingsAccountFormAwamoId").val(a.awamoId);$("#newSavingsAccountFormInterestRate").val("0");$.ajax({url:host+"/client/v1d/find?awamoId="+a.awamoId+"&deviceId=cockpit&datatype=PHOTOGRAPHY",type:"GET",headers:getAuthenticationHeader(),xhrFields:{responseType:"arraybuffer"}}).done(function(d){var c=new Blob([d],{type:"image/jpg"});var b=new FileReader();b.onload=function(f){document.getElementById("newSavingsAccountFormClientImageID").src=f.target.result};b.readAsDataURL(c)}).fail(function(b){document.getElementById("newSavingsAccountFormClientImageID").src="images/personPlaceholderNoText.png";console.log("fail");console.log(b)});$("#newSavingsAccountFormIdDocumentType").val(a.iddocumenttype);$("#newSavingsAccountFormIdDocument").val(a.iddocument);$("#newSavingsAccountFormPhone1").val(a.phone1);$("#newSavingsAccountFormGender").val(a.gender);$("#newSavingsAccountFormWithInterestYes").off("click");$("#newSavingsAccountFormWithInterestYes").on("click",SavingsAccountHandler.prototype.newSavingsAccountFormToggleInterestRateRadioBtn);$("#newSavingsAccountFormWithInterestNo").off("click");$("#newSavingsAccountFormWithInterestNo").on("click",SavingsAccountHandler.prototype.newSavingsAccountFormToggleInterestRateRadioBtn);$("#newSavingsAccountFormSubmitBtn").show();$("#newSavingsAccountFormCancelBtn").show();clearFormValidators($("#newSavingsAccountForm"));registerKeyPressValidators($("#newSavingsAccountForm"))};SavingsAccountHandler.prototype.newSavingsAccountFormToggleInterestRateRadioBtn=function(){if($("#newSavingsAccountFormWithInterestYes").is(":checked")){document.getElementById("newSavingsAccountFormInterestRate").disabled=false}if($("#newSavingsAccountFormWithInterestNo").is(":checked")){document.getElementById("newSavingsAccountFormInterestRate").disabled=true;$("#newSavingsAccountFormInterestRate").val("0")}};SavingsAccountHandler.prototype.outputAccount=function(b){var a=null;if("savingsAccountApplications"===currentTable){if(b.status==="SUBMITTED"){a=SavingsAccountHandler.self.addToTable(b)}else{}}else{if("allSavingsAccounts"===currentTable){a=SavingsAccountHandler.self.addToTable(b)}else{}}return a};SavingsAccountHandler.prototype.entityChanged=function(a){if(currentChangedFil==="ALL"){SavingsAccountHandler.self.outputAccount(a)}else{if(a.status.valueOf()===currentChangedFil){SavingsAccountHandler.self.outputAccount(a)}}};SavingsAccountHandler.prototype.dataModelChanged=function(){};SavingsAccountHandler.prototype.addToTable=function(f){var a=null;if("savingsAccountApplications"===currentTable||"allSavingsAccounts"===currentTable){var h=SavingsAccountHandler.ALL_ACCOUNTS_TITLES;if("savingsAccountApplications"===currentTable){h=SavingsAccountHandler.APPLICATION_TITLES}var e=$("#defaultTableContainer");if(e.is(":visible")){var c=e.find("table");var b=c.find("tbody");var a=b.find('[data-id="'+f.accountId+'"]');var g=a.data("object");var d=SavingsAccountHandler.prototype.getRowData(h,f);SavingsAccountHandler.self.previousPage()}}};SavingsAccountHandler.prototype.displaySavingsAccountApplications=function(){SavingsAccountHandler.prototype.currentSavingsAccount=null;initDefaultContent("Savings Account Applications");$("#syncNow").off("click touch");$("#syncNow").on("click touch",SavingsAccountHandler.self.synchronizeNow);$("#syncNow").attr("title","Sync savings accounts applications");$("#syncNow").show();SavingsAccountHandler.self.removeTableFilterClasses();SavingsAccountHandler.self.displayInTable(SavingsAccountHandler.APPLICATION_TITLES,savingsAccountList.getListByStatus("SUBMITTED"),"actionRequiredSavingsAcTable");$("#defaultTableContainer").addClass("allSavingsAccountsTable");showPrintButton(exportListName.savingsAccounts,exportListFilter.submitted,SavingsAccountHandler.APPLICATION_TITLES);showExcelButton(exportListName.savingsAccounts,exportListFilter.submitted,SavingsAccountHandler.APPLICATION_TITLES)};SavingsAccountHandler.prototype.displayAllSavingsAccountsForCloseDepositWithdraw=function(){SavingsAccountHandler.prototype.currentSavingsAccount=null;SavingsAccountHandler.self.removeTableFilterClasses();SavingsAccountHandler.self.displayInTableForCloseDepositWithdraw(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getListByStatus("ACTIVE"));$("#defaultTableContainer").addClass("allSavingsAccountsTableForCloseDepositWithdraw")};SavingsAccountHandler.prototype.displayAllSavingsAccounts=function(){SavingsAccountHandler.prototype.currentSavingsAccount=null;initDefaultContent("");$("#syncNow").off("click touch");$("#syncNow").on("click touch",SavingsAccountHandler.self.synchronizeNow);$("#syncNow").attr("title","Sync savings accounts");$("#syncNow").show();$("#SavingAccountReportType").show();$("#SavingsAccountReportTypeForm").show();document.getElementById("SavingAccountReportType").selectedIndex="0";SavingsAccountHandler.self.removeTableFilterClasses();var a=savingsAccountList.getEntities();SavingsAccountHandler.self.displayInTable(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,a);showPrintButton(exportListName.savingsAccounts,exportListFilter.all,SavingsAccountHandler.APPLICATION_TITLES);showExcelButton(exportListName.savingsAccounts,exportListFilter.all,SavingsAccountHandler.APPLICATION_TITLES);$("#defaultTableContainer").addClass("allSavingsAccountsTable")};SavingsAccountHandler.prototype.removeTableFilterClasses=function(){$("#defaultTableContainer").removeClass("allSavingsAccountsTable")};SavingsAccountHandler.prototype.displayInTable=function(c,f,k){var e=$("#defaultTableContainer");e.empty();var j=null;if(k===undefined){j=getDefaultRowContainer(c,true)}else{j=getDefaultRowContainer(c,true,k)}var h=j.parent();for(var b=0;b<f.length;b++){addRow(j,SavingsAccountHandler.prototype.getRowData(c,f[b]),f[b],SavingsAccountHandler.self.rowClickHandler,f[b].accountId)}var d=getDefaultTableSorter();d.headers={3:{sorter:"awamoPercentageSorter"},4:{sorter:"awamoCurrencySorter"}};initialize_datatable(h);var a=document.getElementById("defaultTableContainer").getElementsByTagName("table");for(var b=0;b<a.length;b++){a[b].style.textAlign="right"}addClassToTableColumn(h,3,"percentage");addClassToTableColumn(h,4,"currency");$("#tableTotal").text(f.length);showContent($("#tableTotalSum"));showContent($("#emailLoanReportDiv"));showContent(e);e.show();$("#sendsavingaccountEmailReportBotton").off("click touch");$("#sendsavingaccountEmailReportBotton").on("click touch",SavingsAccountHandler.self.sendEmailLoanReportRequest);$("#sendsavingaccountEmailReportBotton").show();if(handlers.Permissions.check_access("_EXPORT_ACCOUNTS")){var g=$("#defaultTableContainer").tableExport();g.tableExport.update({formats:["xls","xlsx"],fileName:"SavingsAccounts",headings:true})}$("#hiddenPrintedTitle").val("Savingaccounts Report")};SavingsAccountHandler.prototype.displayInTableForCloseDepositWithdraw=function(h,f){initDefaultContent("Select Account To Close, Withdraw or Deposit");var g=$("#defaultTableContainer");g.empty();var a=getDefaultRowContainer(h,true,"bankingSvcsSavingsAcTable");var c=a.parent();a=c.find("tbody");for(var e=0;e<f.length;e++){addRow(a,SavingsAccountHandler.prototype.getRowData(h,f[e]),f[e],SavingsAccountHandler.self.rowClickHandlerForCloseDepositWithdrawActions,f[e].accountId)}var b=getDefaultTableSorter();b.headers={3:{sorter:"awamoPercentageSorter"},4:{sorter:"awamoCurrencySorter"}};initialize_datatable(c);var d=document.getElementById("defaultTableContainer").getElementsByTagName("table");for(var e=0;e<d.length;e++){d[e].style.textAlign="right"}addClassToTableColumn(c,3,"percentage");addClassToTableColumn(c,4,"currency");$("#tableTotal").text(f.length);showContent($("#tableTotalSum"));showContent($("#emailLoanReportDiv"));showContent(g);g.show();$("#sendsavingaccountEmailReportBotton").off("click touch");$("#sendsavingaccountEmailReportBotton").on("click touch",SavingsAccountHandler.self.sendEmailLoanReportRequest);$("#sendsavingaccountEmailReportBotton").show();if(handlers.Permissions.check_access("_EXPORT_ACCOUNTS")){}$("#hiddenPrintedTitle").val("Savingaccounts Report")};SavingsAccountHandler.prototype.rowClickHandlerForCloseDepositWithdrawActions=function(b,a){if(exists(a)){SavingsAccountHandler.self.previousPage=a}SavingsAccountHandler.self.displayOneSavingsAccountForCloseDepositWithdraw($(b.currentTarget).data("object"))};SavingsAccountHandler.prototype.rowClickHandler=function(b,a){if(exists(a)){SavingsAccountHandler.self.previousPage=a}clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();$("#singleActions a").off("click touch");$("#singleActions a").on("click touch",SavingsAccountHandler.prototype.singleObjectActionHandler);$("#approveNo").off("click touch");$("#approveNo").on("click touch",SavingsAccountHandler.prototype.backToDisplayOneSavingsAccount);$("#rejectNo").off("click touch");$("#rejectNo").on("click touch",SavingsAccountHandler.prototype.backToDisplayOneSavingsAccount);$("#closeNo").off("click touch");$("#closeNo").on("click touch",SavingsAccountHandler.prototype.backToDisplayOneSavingsAccount);$("#approveYes").off("click touch");$("#approveYes").on("click touch",SavingsAccountHandler.prototype.approveApplication);$("#rejectYes").off("click touch");$("#rejectYes").on("click touch",SavingsAccountHandler.prototype.rejectApplication);$("#closeYes").off("click touch");$("#closeYes").on("click touch",SavingsAccountHandler.prototype.closeApplication);SavingsAccountHandler.self.displayOneSavingsAccount($(b.currentTarget).data("object"))};SavingsAccountHandler.prototype.getRowData=function(d,c){var e={};for(var a in d){var b=c[a];switch(a){case"clientImage":b='<img src="images/personPlaceholderNoText.png" alt="client" height="32" />';if("GROUP"===c.savingsAccountType){b='<img src="images/groupPlaceholder.png" alt="client" height="32" />'}else{if("INDIVIDUAL"===c.savingsAccountType){b='<img src="images/personPlaceholderNoText.png" alt="client" height="32" />'}}break;case"interestRate":b=formatPercentage(b)+" %";break;case"balance":b=formatCurrency(b)+" "+currencyCode;break;case"submitDate":b=formatDate(b);default:break}e[a]=String(b)}return e};SavingsAccountHandler.prototype.displayOneSavingsAccountForCloseDepositWithdraw=function(b){if(!exists(b)){return}SavingsAccountHandler.self.savingsAccount=b;initDefaultContent("Withdraw, Close And Deposit Savings Account");var a=SavingsAccountHandler.self.getRowData(SavingsAccountHandler.CUSTOMISED_ACCOUNT_TITLES,b);$("#savingsAccountCloseDepositWithdrawFormNumber").val(a.accountNo);$("#savingsAccountCloseDepositWithdrawFormName").val(a.clientName);$("#savingsAccountCloseDepositWithdrawFormStatus").val(a.status);$("#savingsAccountCloseDepositWithdrawFormInterest").val(a.interestRate);$("#savingsAccountCloseDepositWithdrawFormAwamoID").val(a.awamoId);$("#savingsAccountCloseDepositWithdrawFormAccountID").val(a.accountId);$("#savingsAccountCloseDepositWithdrawDiv .balance .value").val(a.balance);if(exists(b.transactionList)&&b.transactionList.length>0){$("#savingsAccountCloseDepositWithdrawFormTransactionsTableContainer").parent().siblings(".no-info-to-display").addClass("hidden");SavingsAccountHandler.self.displayTransactionsDataForCloseDepositWithdrawForm(b.transactionList)}else{$("#savingsAccountCloseDepositWithdrawFormTransactionsTableContainer").parent().siblings(".no-info-to-display").removeClass("hidden")}$("#savingsAccountCloseDiv").hide();$("#savingsAccountWithdrawDiv").hide();$("#savingsAccountDepositDiv").hide();showContent($("#savingsAccountCloseDepositWithdrawDiv"))};SavingsAccountHandler.prototype.handleSavingsAccountDepositAccountOption=function(){var a=SavingsAccountHandler.self.savingsAccount;$("#savingsAccountDepositDiv").show();var b=SavingsAccountHandler.self.getRowData(SavingsAccountHandler.CUSTOMISED_ACCOUNT_TITLES,a);initDefaultContent("Deposit to savings account");$("#savingsAccountDepositFormNumber").val(b.accountNo);$("#savingsAccountDepositFormName").val(b.clientName);$("#savingsAccountDepositFormStatus").val(b.status);$("#savingsAccountDepositFormInterest").val(b.interestRate);$("#savingsAccountDepositFormAwamoId").val(b.awamoId);$("#savingsAccountDepositFormAccountId").val(b.accountId);$("#savingsAccountDepositFormBalance").val(b.balance);$("#savingsAccountDepositFormAmount").val("");document.getElementById("savingsAccountDepositFormDepositBtn").disabled=false;document.getElementById("savingsAccountDepositFormCancelBtn").disabled=false;$("#savingsAccountDepositFormCancelBtn").off("click touch");$("#savingsAccountDepositFormCancelBtn").click(function(){SavingsAccountHandler.self.displayOneSavingsAccountForCloseDepositWithdraw(a)});document.getElementById("savingsAccountDepositFormImageID").src="images/personPlaceholderNoText.png";showContent($("#savingsAccountDepositDiv"));$.ajax({url:host+"/client/v1d/find?awamoId="+b.awamoId+"&deviceId=cockpit&datatype=PHOTOGRAPHY",type:"GET",headers:getAuthenticationHeader(),xhrFields:{responseType:"arraybuffer"}}).done(function(f){var d=new Blob([f],{type:"image/jpg"});var c=new FileReader();c.onload=function(g){document.getElementById("savingsAccountDepositFormImageID").src=g.target.result};c.readAsDataURL(d)}).fail(function(c){document.getElementById("savingsAccountDepositFormImageID").src="images/personPlaceholderNoText.png"});clearFormValidators($("#savingsAccountDepositForm"));registerKeyPressValidators($("#savingsAccountDepositForm"))};SavingsAccountHandler.prototype.handleSavingsAccountWithdrawAccountOption=function(){var b=SavingsAccountHandler.self.savingsAccount;$("#savingsAccountWithdrawDiv").show();var c=SavingsAccountHandler.self.getRowData(SavingsAccountHandler.CUSTOMISED_ACCOUNT_TITLES,b);initDefaultContent("Withdraw from savings account");$("#savingsAccountWithdrawFormNumber").val(c.accountNo);$("#savingsAccountWithdrawFormName").val(c.clientName);$("#savingsAccountWithdrawFormStatus").val(c.status);$("#savingsAccountWithdrawFormInterest").val(c.interestRate);$("#savingsAccountWithdrawFormAwamoId").val(c.awamoId);$("#savingsAccountWithdrawFormAccountId").val(c.accountId);$("#savingsAccountWithdrawFormBalance").val(c.balance);$("#savingsAccountWithdrawFormAmount").val("");var a=(c.balance.toString()).slice(0,-4);a=a.replace(/,/g,"");$("#savingsAccountWithdrawFormAmount").attr("maxAmount",a);document.getElementById("savingsAccountWithdrawFormImageID").src="images/personPlaceholderNoText.png";document.getElementById("savingsAccountWithdrawFormCancelBtn").disabled=false;document.getElementById("savingsAccountWithdrawFormWithdrawBtn").disabled=false;if(parseFloat(c.balance)>0){document.getElementById("savingsAccountWithdrawFormWithdrawBtn").disabled=false}else{document.getElementById("savingsAccountWithdrawFormWithdrawBtn").disabled=true}$("#savingsAccountWithdrawFormCancelBtn").off("click touch");$("#savingsAccountWithdrawFormCancelBtn").click(function(){SavingsAccountHandler.self.displayOneSavingsAccountForCloseDepositWithdraw(b)});showContent($("#savingsAccountWithdrawDiv"));$.ajax({url:host+"/client/v1d/find?awamoId="+c.awamoId+"&deviceId=cockpit&datatype=PHOTOGRAPHY",type:"GET",headers:getAuthenticationHeader(),xhrFields:{responseType:"arraybuffer"}}).done(function(g){var f=new Blob([g],{type:"image/jpg"});var d=new FileReader();d.onload=function(h){document.getElementById("savingsAccountWithdrawFormImageID").src=h.target.result};d.readAsDataURL(f)}).fail(function(d){document.getElementById("savingsAccountWithdrawFormImageID").src="images/personPlaceholderNoText.png"});clearFormValidators($("#savingsAccountWithdrawForm"));registerKeyPressValidators($("#savingsAccountWithdrawForm"))};SavingsAccountHandler.prototype.handleSavingsAccountCloseAccountOption=function(){clearFormValidators($("#savingsAccountCloseForm"));registerKeyPressValidators($("#savingsAccountCloseForm"));var a=SavingsAccountHandler.self.savingsAccount;document.getElementById("savingsAccountCloseFormWithdrawToZeroBtn").disabled=false;document.getElementById("savingsAccountCloseFormCloseBtn").disabled=false;document.getElementById("savingsAccountCloseFormCancelBtn").disabled=false;var b=SavingsAccountHandler.self.getRowData(SavingsAccountHandler.CUSTOMISED_ACCOUNT_TITLES,a);initDefaultContent("Close savings account");$("#savingsAccountCloseFormNumber").val(b.accountNo);$("#savingsAccountCloseFormName").val(b.clientName);$("#savingsAccountCloseFormStatus").val(b.status);$("#savingsAccountCloseFormInterest").val(b.interestRate);$("#savingsAccountCloseFormAwamoId").val(b.awamoId);$("#savingsAccountCloseFormAccountId").val(b.accountId);$("#savingsAccountCloseFormBalance").val(b.balance);$("#savingsAccountCloseFormClosingNote").val("");document.getElementById("savingsAccountCloseFormImageID").src="images/personPlaceholderNoText.png";if(parseFloat(b.balance)>0){document.getElementById("savingsAccountCloseFormWithdrawToZeroBtn").disabled=false}else{document.getElementById("savingsAccountCloseFormWithdrawToZeroBtn").disabled=true}$("#savingsAccountCloseFormCancelBtn").click(function(){SavingsAccountHandler.self.displayOneSavingsAccountForCloseDepositWithdraw(a)});showContent($("#savingsAccountCloseDiv"));$.ajax({url:host+"/client/v1d/find?awamoId="+b.awamoId+"&deviceId=cockpit&datatype=PHOTOGRAPHY",type:"GET",headers:getAuthenticationHeader(),xhrFields:{responseType:"arraybuffer"}}).done(function(f){var d=new Blob([f],{type:"image/jpg"});var c=new FileReader();c.onload=function(g){document.getElementById("savingsAccountCloseFormImageID").src=g.target.result};c.readAsDataURL(d)}).fail(function(c){document.getElementById("savingsAccountCloseFormImageID").src="images/personPlaceholderNoText.png"})};SavingsAccountHandler.prototype.handleSavingsAccountDepositAction=function(){if(validateForm($("#savingsAccountDepositForm"))){var e=$("#savingsAccountDepositFormAccountId").val();var a=parseFloat(removeCommas($("#savingsAccountDepositFormAmount").val()));var f=parseFloat(unformatCurrency($("#savingsAccountDepositFormBalance").val()));if(!isNaN(a)&&isFinite($("#savingsAccountWithdrawFormAmount").val())){if(!(a>0)){showContent($("#savingsAccountDepositDiv"));showAlertMessage("Please input a deposit amount greater than 0",AlertTypes.warning)}else{savingsAccountTransactionDate=Date.now();savingsAccountNewAcBalance=f+(a);savingsAccountNewAcBalance=savingsAccountNewAcBalance*100;savingsAccountTransactionBody='{"accountId":"'+e+'","transactionDate":"'+savingsAccountTransactionDate+'","amount":"'+unformatCurrency($("#savingsAccountDepositFormAmount").val())+'","transactionType":"DEPOSIT","paymentTypeId":"1"}';var c="Confirm Deposit";var g="Please confirm that you want to make a deposit of "+a+" to this savings account";var d="Confirm";var b="Cancel";showDialogPopupWithHandlers(c,g,d,SavingsAccountHandler.prototype.handleConfirmSubmitDepositTransaction,b,SavingsAccountHandler.prototype.handleDeclineSubmitDepositTransation)}}else{showContent($("#savingsAccountDepositDiv"));showAlertMessage("Please input a valid amount for the deposit amount",AlertTypes.warning)}}else{showAlertMessage("Please ensure that all the fields are filled in correctly.",AlertTypes.danger)}};SavingsAccountHandler.prototype.handleConfirmSubmitDepositTransaction=function(){var a=SavingsAccountHandler.ROOT_PATH+"deposit";var b=getAuthenticationHeader();$.ajax({url:host+a,data:savingsAccountTransactionBody,dataType:"json",contentType:"application/json; charset=utf-8",headers:b,type:"POST",beforeSend:function(){showLoader();document.getElementById("savingsAccountDepositFormCancelBtn").disabled=true;document.getElementById("savingsAccountDepositFormDepositBtn").disabled=true},success:function(d){$("#savingsAccountDepositFormBalance").val(""+formatCurrency(savingsAccountNewAcBalance));document.getElementById("savingsAccountDepositFormCancelBtn").disabled=false;document.getElementById("savingsAccountDepositFormDepositBtn").disabled=false;$("#savingsAccountDepositDiv").hide();var c=unformatCurrency($("#savingsAccountDepositFormAmount").val());SavingsAccountHandler.prototype.updateLocalAccountAfterTransaction(savingsAccountNewAcBalance,c,"DEPOSIT",savingsAccountTransactionDate,d.transactionId);SavingsAccountHandler.self.displayInTableForCloseDepositWithdraw(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getListByStatus("ACTIVE"));hideLoader();showAlertMessage("Deposit transaction completed successfully",AlertTypes.success)}}).fail(function(c){showContent($("#savingsAccountDepositDiv"));showAlertMessage("Deposit transaction failed, please try again",AlertTypes.danger);hideLoader();document.getElementById("savingsAccountDepositFormCancelBtn").disabled=false;document.getElementById("savingsAccountDepositFormDepositBtn").disabled=false})};SavingsAccountHandler.prototype.handleDeclineSubmitDepositTransation=function(){document.getElementById("savingsAccountDepositFormCancelBtn").disabled=false;document.getElementById("savingsAccountDepositFormDepositBtn").disabled=false};SavingsAccountHandler.prototype.handleSavingsAccountWithdrawAction=function(){if(validateForm($("#savingsAccountWithdrawForm"))){var e=$("#savingsAccountWithdrawFormAccountId").val();var c=parseFloat($("#savingsAccountWithdrawFormAmount").val());var f=parseFloat(unformatCurrency($("#savingsAccountWithdrawFormBalance").val()));if(!isNaN(parseFloat($("#savingsAccountWithdrawFormAmount").val()))&&isFinite($("#savingsAccountWithdrawFormAmount").val())){if(!(c<=f)){showContent($("#savingsAccountWithdrawDiv"));showAlertMessage("Your account balance is less than what is required to complete this transaction",AlertTypes.warning)}else{var h=unformatCurrency($("#savingsAccountWithdrawFormAmount").val());savingsAccountNewAcBalance=f-(c);savingsAccountNewAcBalance=savingsAccountNewAcBalance*100;savingsAccountTransactionDate=Date.now();savingsAccountTransactionBody='{"accountId":"'+e+'","transactionDate":"'+savingsAccountTransactionDate+'","amount":"'+h+'","transactionType":"WITHDRAWAL","paymentTypeId":"1"}';console.log("withdraw body");console.log(savingsAccountTransactionBody);var b="Confirm Withdraw";var g="Please confirm that you want to make a withdraw of "+c+" to this savings account";var d="Confirm";var a="Cancel";showDialogPopupWithHandlers(b,g,d,SavingsAccountHandler.prototype.handleConfirmSubmitWithdrawTransaction,a,SavingsAccountHandler.prototype.handleDeclineSubmitWithdrawTransation)}}else{showContent($("#savingsAccountWithdrawDiv"));showAlertMessage("Please enter a valid amount for the withdraw amount",AlertTypes.warning)}}else{showAlertMessage("Please ensure that all the fields are filled in correctly.",AlertTypes.danger)}};SavingsAccountHandler.prototype.handleConfirmSubmitWithdrawTransaction=function(){var a=SavingsAccountHandler.ROOT_PATH+"withdraw";var b=getAuthenticationHeader();$.ajax({url:host+a,data:savingsAccountTransactionBody,dataType:"json",contentType:"application/json; charset=utf-8",headers:b,type:"POST",beforeSend:function(){showLoader();document.getElementById("savingsAccountWithdrawFormCancelBtn").disabled=true;document.getElementById("savingsAccountWithdrawFormWithdrawBtn").disabled=true},success:function(c){$("#savingsAccountWithdrawDiv").hide();console.log("successful withdraw");console.log(savingsAccountNewAcBalance);$("#savingsAccountWithdrawFormBalance").val(""+formatCurrency(savingsAccountNewAcBalance));console.log("failed withdraw");document.getElementById("savingsAccountWithdrawFormCancelBtn").disabled=false;document.getElementById("savingsAccountWithdrawFormWithdrawBtn").disabled=false;var d=unformatCurrency($("#savingsAccountWithdrawFormAmount").val());console.log(" withdraw b4 update");SavingsAccountHandler.prototype.updateLocalAccountAfterTransaction(savingsAccountNewAcBalance,d,"WITHDRAW",savingsAccountTransactionDate,c.transactionId);console.log("withdraw after update");SavingsAccountHandler.self.displayInTableForCloseDepositWithdraw(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getListByStatus("ACTIVE"));hideLoader();showAlertMessage("Withdraw transaction completed successfully",AlertTypes.success)}}).fail(function(c){showContent($("#savingsAccountWithdrawDiv"));hideLoader();showAlertMessage("Withdraw transaction failed, please try again",AlertTypes.danger);document.getElementById("savingsAccountWithdrawFormCancelBtn").disabled=false;document.getElementById("savingsAccountWithdrawFormWithdrawBtn").disabled=false})};SavingsAccountHandler.prototype.handleDeclineSubmitWithdrawTransation=function(){document.getElementById("savingsAccountWithdrawFormCancelBtn").disabled=false;document.getElementById("savingsAccountWithdrawFormWithdrawBtn").disabled=false};SavingsAccountHandler.prototype.handleSavingsAccountWithdrawToZeroAction=function(){var e=$("#savingsAccountCloseFormAccountId").val();savingsAccountPrevAcBalance=$("#savingsAccountCloseFormBalance").val();savingsAccountNewAcBalance=unformatCurrency($("#savingsAccountCloseFormBalance").val());var a=parseFloat(savingsAccountNewAcBalance);savingsAccountTransactionDate=Date.now();if(!(a>0)){showContent($("#savingsAccountCloseDiv"));showAlertMessage("Your account balance is already zero, you cannot withdraw any amount",AlertTypes.warning)}else{console.log("withdraw to zero ac bal : "+savingsAccountNewAcBalance);console.log("withdraw to zero ac bal2 : "+unformatCurrency(""+a));console.log("withdraw to zero ac bal3 : "+a);var g=getAuthenticationHeader();var f=SavingsAccountHandler.ROOT_PATH+"withdraw";savingsAccountTransactionBody='{"accountId":"'+e+'","transactionDate":"'+savingsAccountTransactionDate+'","amount":"'+unformatCurrency(""+a)+'","transactionType":"WITHDRAWAL","paymentTypeId":"1"}';console.log(g);console.log(savingsAccountTransactionBody);savingsAccountNewAcBalance=unformatCurrency(""+a);var c="Confirm Withdraw To Zero";var h="Please confirm that you want to make a withdraw of "+savingsAccountPrevAcBalance+" to this savings account";var d="Confirm";var b="Cancel";showDialogPopupWithHandlers(c,h,d,SavingsAccountHandler.prototype.handleConfirmSubmitWithdrawToZeroTransaction,b,SavingsAccountHandler.prototype.handleDeclineSubmitWithdrawToZeroTransation)}};SavingsAccountHandler.prototype.handleConfirmSubmitWithdrawToZeroTransaction=function(){var a=SavingsAccountHandler.ROOT_PATH+"withdraw";var b=getAuthenticationHeader();$.ajax({url:host+a,data:savingsAccountTransactionBody,dataType:"json",contentType:"application/json; charset=utf-8",headers:b,type:"POST",beforeSend:function(){showLoader();document.getElementById("savingsAccountCloseFormCancelBtn").disabled=true;document.getElementById("savingsAccountCloseFormWithdrawToZeroBtn").disabled=true;document.getElementById("savingsAccountCloseFormCloseBtn").disabled=true},success:function(c){console.log("withdraw to zero, successful");document.getElementById("savingsAccountCloseFormCancelBtn").disabled=false;document.getElementById("savingsAccountCloseFormWithdrawToZeroBtn").disabled=true;document.getElementById("savingsAccountCloseFormCloseBtn").disabled=false;SavingsAccountHandler.prototype.updateLocalAccountAfterTransaction("0",savingsAccountNewAcBalance,"WITHDRAW",savingsAccountTransactionDate,c.transactionId);SavingsAccountHandler.self.displayTransactionsDataForCloseDepositWithdrawForm(SavingsAccountHandler.self.savingsAccount.transactionList);hideLoader();showAlertMessage("Savings account application successfully withdrawn to zero",AlertTypes.success);$("#savingsAccountCloseFormBalance").val("0");showContent($("#savingsAccountCloseDiv"))}}).fail(function(c){hideLoader();$("#savingsAccountCloseFormBalance").val(savingsAccountPrevAcBalance);showContent($("#savingsAccountCloseDiv"));showAlertMessage("Savings account was not withdrawn to zero",AlertTypes.danger);document.getElementById("savingsAccountCloseFormCancelBtn").disabled=false;document.getElementById("savingsAccountCloseFormWithdrawToZeroBtn").disabled=false;document.getElementById("savingsAccountCloseFormCloseBtn").disabled=false})};SavingsAccountHandler.prototype.handleDeclineSubmitWithdrawToZeroTransation=function(){document.getElementById("savingsAccountCloseFormCancelBtn").disabled=false;document.getElementById("savingsAccountCloseFormWithdrawToZeroBtn").disabled=false;document.getElementById("savingsAccountCloseFormCloseBtn").disabled=false};SavingsAccountHandler.prototype.handleSavingsAccountClosingAction=function(){savingsAccountId=$("#savingsAccountCloseFormAccountId").val();var e=$("#savingsAccountCloseFormClosingNote").val();var g=unformatCurrency($("#savingsAccountCloseFormBalance").val());var a=parseFloat(g);if(a>0){showContent($("#savingsAccountCloseDiv"));showAlertMessage("Please withdraw the account balance to zero, then try again",AlertTypes.warning)}else{if(validateForm($("#savingsAccountCloseForm"))){savingsAccountTransactionBody='{"note":"'+e+'"}';var c="Confirm Closing Account";var f="Please confirm that you want to close this account";var d="Confirm";var b="Cancel";showDialogPopupWithHandlers(c,f,d,SavingsAccountHandler.prototype.handleConfirmCloseAccountAction,b,SavingsAccountHandler.prototype.handleDeclineCloseAccountAction)}else{showAlertMessage("Please ensure that all fields are filled in correctly",AlertTypes.danger)}}};SavingsAccountHandler.prototype.handleConfirmCloseAccountAction=function(){var a=SavingsAccountHandler.ROOT_PATH+savingsAccountId+"/close";var b=getAuthenticationHeader();$.ajax({url:host+a,data:savingsAccountTransactionBody,dataType:"json",contentType:"application/json; charset=utf-8",headers:b,type:"POST",beforeSend:function(){showLoader();document.getElementById("savingsAccountCloseFormCancelBtn").disabled=true;document.getElementById("savingsAccountCloseFormWithdrawToZeroBtn").disabled=true;document.getElementById("savingsAccountCloseFormCloseBtn").disabled=true},success:function(c){$("#savingsAccountCloseDiv").hide();document.getElementById("savingsAccountCloseFormCancelBtn").disabled=false;document.getElementById("savingsAccountCloseFormWithdrawToZeroBtn").disabled=true;document.getElementById("savingsAccountCloseFormCloseBtn").disabled=true;SavingsAccountHandler.prototype.updateLocalAccountAfterClosing();SavingsAccountHandler.self.displayInTableForCloseDepositWithdraw(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getListByStatus("ACTIVE"));hideLoader();showAlertMessage("Savings account closed successfully",AlertTypes.success)},complete:function(){document.getElementById("savingsAccountCloseFormCancelBtn").disabled=false}}).fail(function(c){hideLoader();showContent($("#savingsAccountCloseDiv"));showAlertMessage("Savings account was not closed successfully",AlertTypes.danger);document.getElementById("savingsAccountCloseFormCancelBtn").disabled=false;document.getElementById("savingsAccountCloseFormWithdrawToZeroBtn").disabled=false;document.getElementById("savingsAccountCloseFormCloseBtn").disabled=false})};SavingsAccountHandler.prototype.handleDeclineCloseAccountAction=function(){document.getElementById("savingsAccountCloseFormCancelBtn").disabled=false;document.getElementById("savingsAccountCloseFormWithdrawToZeroBtn").disabled=false;document.getElementById("savingsAccountCloseFormCloseBtn").disabled=false};SavingsAccountHandler.prototype.updateLocalAccountAfterClosing=function(){SavingsAccountHandler.self.savingsAccount.status="CLOSED";savingsAccountList.put(SavingsAccountHandler.self.savingsAccount)};SavingsAccountHandler.prototype.updateLocalAccountAfterTransaction=function(f,a,c,b,e){var d=new Object();d.transactionType=c;d.transactionDate=b;d.amount=a;d.balance=f;SavingsAccountHandler.self.savingsAccount.balance=f;if(!exists(SavingsAccountHandler.self.savingsAccount.transactionList)){SavingsAccountHandler.self.savingsAccount.transactionList=[]}SavingsAccountHandler.self.savingsAccount.transactionList.push(d);savingsAccountList.put(SavingsAccountHandler.self.savingsAccount)};SavingsAccountHandler.prototype.displayOneSavingsAccount=function(b){if(!exists(b)){return}clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();SavingsAccountHandler.self.savingsAccount=b;initDefaultContent("Savings Account");var a=SavingsAccountHandler.self.getRowData(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,b);$("#savingsAccountNumber").val(a.accountNo);$("#savingsAccountName").val(a.clientName);$("#savingsAccountStatus").val(a.status);$("#savingsAccountInterest").val(a.interestRate);$("#savingsAccount .balance .value").val(a.balance);console.log(b);console.log("svngs AC 0");SavingsAccountHandler.self.adjustSingleActionsByStatus(b.status);if(exists(b.transactionList)&&b.transactionList.length>0){console.log("svngs AC 1");$("#savingsAccountTransactionsTableContainer").siblings(".no-info-to-display").addClass("hidden");SavingsAccountHandler.self.displayTransactionsData(b.transactionList)}else{console.log("svngs AC 2");$("#savingsAccountTransactionsTableContainer").siblings(".no-info-to-display").removeClass("hidden");$("#savingsAccountTransactionsTableContainer").siblings(".no-info-to-display").show();$("#savingsAccountTransactionsTableContainer").siblings(".no-info-to-display").parent().show()}showContent($("#singleActions"));hideControlsForReporting("SavingsAccount");showContent($("#savingsAccount"))};SavingsAccountHandler.prototype.displayTransactionsDataForCloseDepositWithdrawForm=function(a){var f=$("#savingsAccountCloseDepositWithdrawFormTransactionsTableContainer");f.empty();var h=getEmptyTable(true);f.append(h);var j=h.find("thead");addRow(j,SavingsAccountHandler.TRANSACTION_TITLES);j=h.find("tbody");if(!exists(a)){return}var e=a.length;for(var c=0;c<e;c++){var b=a[c];var g=SavingsAccountHandler.prototype.getTransactionRowData(b);addRow(j,g,b)}var d=getDefaultTableSorter();d.headers={0:{sorter:"awamoDateSorter"},1:{sorter:"awamoCurrencySorter"},3:{sorter:"awamoCurrencySorter"}};h.tablesorter(d);addClassToTableColumn(h,1,"currency");addClassToTableColumn(h,3,"currency");showContent(h)};SavingsAccountHandler.prototype.displayTransactionsData=function(a){var f=$("#savingsAccountTransactionsTableContainer");f.empty();var h=getEmptyTable(true);f.append(h);var j=h.find("thead");addRow(j,SavingsAccountHandler.TRANSACTION_TITLES);j=h.find("tbody");if(!exists(a)){return}var e=a.length;for(var c=0;c<e;c++){var b=a[c];var g=SavingsAccountHandler.prototype.getTransactionRowData(b);addRow(j,g,b)}var d=getDefaultTableSorter();d.headers={0:{sorter:"awamoDateSorter"},1:{sorter:"awamoCurrencySorter"},3:{sorter:"awamoCurrencySorter"}};h.tablesorter(d);addClassToTableColumn(h,1,"currency");addClassToTableColumn(h,3,"currency");showContent(h)};SavingsAccountHandler.prototype.getTransactionRowData=function(c){var d={};for(var a in SavingsAccountHandler.TRANSACTION_TITLES){var b=c[a];switch(a){case"transactionDate":b=formatDate(b);break;case"amount":case"balance":b=formatCurrency(b)+" "+currencyCode;break;default:break}d[a]=String(b)}return d};SavingsAccountHandler.prototype.singleObjectActionHandler=function(d){d.preventDefault();switch($(this).data("action")){case"back":hideContent();SavingsAccountHandler.self.previousPage();hideControlsForReporting("SavingsAccount");break;case"approve":var b="Confirm Savings Accounts Application Approval";var e="Are you sure you want to approve this application ?";var c="Yes";var a="No";showDialogPopupWithHandlers(b,e,c,function(){SavingsAccountHandler.prototype.approveApplication()},a,function(){SavingsAccountHandler.prototype.backToDisplayOneSavingsAccount()});break;case"reject":var b="Confirm Savings Accounts Application Rejection";var e="Are you sure you want to reject this application ?";var c="Yes";var a="No";showDialogPopupWithHandlers(b,e,c,function(){SavingsAccountHandler.prototype.rejectApplication()},a,function(){SavingsAccountHandler.prototype.backToDisplayOneSavingsAccount()});break;case"close":hideContent();$("#closeApplication .panel-body .closeObject").text("savings account");showContent($("#closeApplication"));break;default:break}};SavingsAccountHandler.prototype.adjustSingleActionsByStatus=function(a){$("#singleActions a[data-action]").hide();$('#singleActions a[data-action="back"]').show();switch(a){case"SUBMITTED":$('#singleActions a[data-action="approve"]').show();$('#singleActions a[data-action="reject"]').show();break;case"REJECTED":break;case"ACTIVE":$('#singleActions a[data-action="close"]').show();break;case"CLOSED":break;default:break}};SavingsAccountHandler.prototype.backToDisplayOneSavingsAccount=function(){SavingsAccountHandler.self.displayOneSavingsAccount(SavingsAccountHandler.self.savingsAccount)};SavingsAccountHandler.prototype.approveApplication=function(){SavingsAccountHandler.self.savingsAccount.status="ACTIVE";showLoader();ajax(SavingsAccountHandler.ROOT_PATH+SavingsAccountHandler.self.savingsAccount.accountId+"/approve","POST",SavingsAccountHandler.prototype.approveApplicationSuccessful)};SavingsAccountHandler.prototype.approveApplicationSuccessful=function(){hideLoader();showAlertMessage("Savings Account approved sucessfully",AlertTypes.success);SavingsAccountHandler.self.savingsAccount.status="ACTIVE";savingsAccountList.put(savingsAccountList,SavingsAccountHandler.self.savingsAccount);SavingsAccountHandler.self.previousPage();SavingsAccountHandler.prototype.getApplications()};SavingsAccountHandler.prototype.rejectApplication=function(){SavingsAccountHandler.self.savingsAccount.status="REJECTED";showLoader();ajax(SavingsAccountHandler.ROOT_PATH+SavingsAccountHandler.self.savingsAccount.accountId+"/reject","POST",SavingsAccountHandler.prototype.rejectApplicationSuccessful,'{"note":"'+$("#rejectionNote").val()+'"}')};SavingsAccountHandler.prototype.rejectApplicationSuccessful=function(){SavingsAccountHandler.self.savingsAccount.status="REJECTED";hideLoader();showAlertMessage("Savings Account rejected sucessfully",AlertTypes.success);savingsAccountList.put(savingsAccountList,SavingsAccountHandler.self.savingsAccount);SavingsAccountHandler.self.previousPage()};SavingsAccountHandler.prototype.closeApplication=function(){SavingsAccountHandler.self.savingsAccount.status="CLOSED";showLoader();ajax(SavingsAccountHandler.ROOT_PATH+SavingsAccountHandler.self.savingsAccount.accountId+"/close","POST",SavingsAccountHandler.prototype.closeApplicationSuccessful,'{"note":"'+$("#closeNote").val()+'"}')};SavingsAccountHandler.prototype.closeApplicationSuccessful=function(){SavingsAccountHandler.self.savingsAccount.status="CLOSED";hideLoader();showAlertMessage("Savings Account closed sucessfully",AlertTypes.success);savingsAccountList.put(savingsAccountList,SavingsAccountHandler.self.savingsAccount);SavingsAccountHandler.self.previousPage()};SavingsAccountHandler.prototype.loadSavingsAccounts=function(){savingsAccountList.reload()};SavingsAccountHandler.prototype.synchronizeNow=function(){savingsAccountList.reload()};SavingsAccountHandler.prototype.sendEmailLoanReportRequest=function(){var c={tenantId:tenantId};var b="/tenant/v1d/mis/reportEmail";var a='{"startTime":"0","endTime":"0","reportEmailEntity":"SAVINGS_ACCOUNTS","reportEmailType":"ALL","email":"'+$("#emailReportC").val()+'"}';ajax(b,"POST",SavingsAccountHandler.prototype.emailReportResponseHandler,a,c,SavingsAccountHandler.prototype.emailReportFailedResponseHandler)};SavingsAccountHandler.prototype.emailReportResponseHandler=function(a){message("Success","Message Sent Successfully",MessageType.SUCCESS)};SavingsAccountHandler.prototype.emailReportFailedResponseHandler=function(a){message("Error",a.responseJSON.message,MessageType.WARNING)};SavingsAccountHandler.prototype.savingsAccountMainMenuOverview=function(){addHistory("Bankings Services Savings Account","#bankingServicesSavingsAccountOverview",getSidebarSubitemSelector("bankingServices","SavingsAccount","savingsAccountMainMenuOverview"));initDefaultContent("Savings Accounts");clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();currentTable="options";var a=getDefaultRowContainer({type:"Items Available"});if(handlers.Permissions.check_access("_CREATE_NEW_ACCOUNT")){addRow(a,{type:"Create New Account"},"SavingsAccount",SavingsAccountHandler.prototype.showAllClientsForSavingsAccountApplication,"showAllClientsForSavingsAccountApplication")}if(handlers.Permissions.check_access("_MANAGE_ACCOUNTS")){addRow(a,{type:"Use Existing Account"},"SavingsAccount",SavingsAccountHandler.prototype.getAllForCloseDepositAndWithdraw,"getAllForCloseDepositAndWithdraw")}};SavingsAccountHandler.prototype.savingsAccountMainMenuRowClickHandler=function(){var b=$(this).data("id");var a=$(this).data("object");$('li[data-parent~="bankingServices"][data-handler="'+a+'"][data-action~="'+b+'"] a').click()};SavingsAccountHandler.prototype.genericSavingAccountReportSelectHandler=function(){switch($(this).val()){case"ALL":currentChangedFil="ALL";SavingsAccountHandler.self.displayInTable(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getEntities());break;case"ACTIVE":currentChangedFil="ACTIVE";SavingsAccountHandler.self.displayInTable(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getListByStatus("ACTIVE"));break;case"CLOSED":currentChangedFil="CLOSED";SavingsAccountHandler.self.displayInTable(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getListByStatus("CLOSED"));break;case"REJECTED":currentChangedFil="CLOSED";SavingsAccountHandler.self.displayInTable(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getListByStatus("REJECTED"));break;case"SUBMITTED":currentChangedFil="SUBMITTED";SavingsAccountHandler.self.displayInTable(SavingsAccountHandler.ALL_ACCOUNTS_TITLES,savingsAccountList.getListByStatus("SUBMITTED"));break;default:break}};