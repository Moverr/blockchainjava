"use strict";var manageClientEditedBirthDate;var clientImage;var ClientHandler=function(){ClientHandler.self=this;clientList.addEntityChangedEventListenerCallback(ClientHandler.prototype.entityChanged);$("#manageClientIdDocumentType").on("input",ClientHandler.prototype.clientDocumentTypeSelectHandler);$("#manageClientEditBtn").on("click",ClientHandler.prototype.handleManageClientEditClientDataButton);$("#manageClientBackEditBtn").on("click",ClientHandler.prototype.manageClientsGetAll);$("#manageClientCancelEditBtn").on("click",ClientHandler.prototype.handleManageClientCancelEditClientDataButton);$("#manageClientPrintFormBtn").on("click",ClientHandler.prototype.printClientInfomation);$("#manageClientSubmitEditBtn").off("click");$("#manageClientSubmitEditBtn").on("click",ClientHandler.prototype.handleManageClientSubmitEditClientDataButton);$("#manageClientCancelSubmitEditBtn").on("click",ClientHandler.prototype.handleManageClientCancelSubmitEditClientDataButton);$("#manageClientConfirmSubmitEditBtn").on("click",ClientHandler.prototype.handleManageClientConfirmSubmitEditClientDataButton);$("#manageClientEditImageIDSelector").on("change",ClientHandler.prototype.manageClientEditClientImageUpload);$("#singleClientActions a").on("click touch",ClientHandler.self._singleClientActionHandler)};ClientHandler.prototype.clientDocumentTypeSelectHandler=function(){if(document.getElementById("manageClientIdDocumentType").value==="NONE"){document.getElementById("manageClientIdDocument").required=false;document.getElementById("manageClientIdDocument").disabled=true;document.getElementById("manageClientIdDocument").value=""}else{document.getElementById("manageClientIdDocument").required=true;document.getElementById("manageClientIdDocument").disabled=false}registerKeyPressValidators($("#manageClientForm"))};ClientHandler.ALL_CLIENTS_TITLES={fullname:"Name",gender:"Sex",birthdate:"Birth date",submitDate:"Registration",phone1:"Phone",account:"Balance",loan:"Loan"};ClientHandler.ACCOUNTS_TITLES={accountNo:"Account",type:"Type",status:"Status",interestRate:"Interest rate p.a.",balance:"Balance"};ClientHandler.prototype.getAll=function(){addHistory("All clients","#clients",getSidebarSubitemSelector("reporting","Client","getAll"));currentTable="allClients";ClientHandler.self.previousPage=ClientHandler.self.getAll;ClientHandler.self.displayClients()};ClientHandler.prototype.manageClientsGetAll=function(){addHistory("All Clients","#clients",getSidebarSubitemSelector("manageClients","Client","manageClientsGetAll"));currentTable="allClients";ClientHandler.self.previousPage=ClientHandler.self.manageClientsGetAll;ClientHandler.self.manageClientsDisplayClients()};ClientHandler.prototype.loadClients=function(){clientList.reload()};ClientHandler.prototype.printClientInfomation=function(g){g.preventDefault();var p=$("#manageClientFirstName").val();var j=$("#manageClientLastName").val();var m=$("#manageClientMiddleName").val();var i=$("#manageClientBirthdate").val();var b=$("#manageClientNationality").val();var c=$("#manageClientIdDocumentType").val();var l=$("#manageClientIdDocument").val();var o=$("#manageClientPhone1").val();var n=$("#manageClientPhone2").val();var k=$("#manageClientGender").val();var f=$("#manageClientAwamoId").val();if(clientImage===undefined){clientImage="images/personPlaceholderNoText.png"}var a='<div class="panel panel-default" id="printClientPanel">\n								<div class="panel-heading" id="printClientPanelHeading">Client Information</div>\n								<div class="panel-body" id="printClientPanelBody">\n									<div class="col-xs-12">\n										<div class="col-xs-4" id="printClientImageDiv"> <img class="manImg" id="printClientImage" src="'+clientImage+'" height="250px" width="100%" alt="pic"> </div>\n										<div class="col-xs-8" id="printClientInformationDiv">\n											<table>\n												<tbody>\n													<tr>\n														<td><strong>First name</strong></td>\n														<td>'+p+"</td>\n													</tr>\n													<tr>\n														<td><strong>Last name</strong></td>\n														<td>"+j+"</td>\n													</tr>\n													<tr>\n														<td><strong>Middle name</strong></td>\n														<td>"+m+"</td>\n													</tr>\n													<tr>\n														<td><strong>Birthdate</strong></td>\n														<td>"+i+"</td>\n													</tr>\n													<tr>\n														<td><strong>Nationality</strong></td>\n														<td>"+b+"</td>\n													</tr>\n													<tr>\n														<td><strong>Id type</strong></td>\n														<td>"+c+"</td>\n													</tr>\n													<tr>\n														<td><strong>Id Number</strong> </td>\n														<td>"+l+"</td>\n													</tr>\n													<tr>\n														<td><strong>Phone</strong></td>\n														<td>"+o+"</td>\n													</tr>\n													<tr>\n														<td><strong>Phone(2)</strong></td>\n														<td>"+n+"</td>\n													</tr>\n													<tr>\n														<td><strong>Gender</strong></td>\n														<td>"+k+"</td>\n													</tr>\n												</tbody>\n											</table>\n										</div>\n									</div>\n								</div>\n							</div>";var h='<table>\n							<tr><td rowspan="11" style="padding:0 15px 0 15px;"><img class="manImg" id="clientImage" src="'+clientImage+'" height="320px" width="240px" style="padding-bottom:3px;" alt="pic"></td></tr>\n							<tr><td>First name : </td><td>'+p+"</td></tr>\n							<tr><td>Last name : </td><td>"+j+"</td></tr>\n							<tr><td>Middle name : </td><td>"+m+"</td></tr>\n							<tr><td>Birthdate : </td><td>"+i+"</td></tr>\n							<tr><td>Nationality : </td><td>"+b+"</td></tr>\n							<tr><td>Id Document type : </td><td>"+c+"</td></tr>\n							<tr><td>Id Document : </td><td>"+l+"</td></tr>\n							<tr><td>Phone : </td><td>"+o+"</td></tr>\n							<tr><td>Phone(2) : </td><td>"+n+"</td></tr>\n							<tr><td>Gender : </td><td>"+k+"</td></tr>\n						  </table>";var d=window.open("","Print-Window");d.document.open();d.document.write('<html>\n							<head>\n								<title>Print Client</title>\n								<link href="css/libs/bootstrap.min.css" rel="stylesheet">\n								<link href="css/printClientCss.css" rel="stylesheet">\n								<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">\n								<link href="css/libs/theme.bootstrap.min.css" rel="stylesheet" media="print">\n								<link rel="icon" type="image/png" sizes="16x16" href="favicon.png">\n							</head>\n							<body onload="window.focus(); window.print();">\n								'+a+"							</body>\n						   </html>");d.document.close()};ClientHandler.prototype.displayClients=function(){$("body").scrollTop(0);ClientHandler.self.currentClient=null;initDefaultContent("All clients");$("#syncNow").off("click touch");$("#syncNow").on("click touch",ClientHandler.self.synchronizeNow);$("#syncNow").attr("title","Sync Clients List");$("#syncNow").show();$("#sendclientEmailReportBotton").off("click touch");$("#sendclientEmailReportBotton").on("click touch",ClientHandler.self.sendEmailLoanReportRequest);$("#sendclientEmailReportBotton").show();var n=clientList.getEntities();var r=getDefaultRowContainer(ClientHandler.ALL_CLIENTS_TITLES,true,"reportingClientsTable");var q=r.parent();for(var g=0;g<n.length;g++){var s={};for(var o in ClientHandler.ALL_CLIENTS_TITLES){var f=n[g][o];if("birthdate"===o||"submitDate"===o){f=formatDate(f)}if("account"===o){var b=savingsAccountList.getByClient(n[g]["awamoId"]);var m=b.length;if(m>0){var l=0;for(var d=0;d<m;d++){var a=b[d];l=l+a.balance}f=formatCurrency(l)+" "+currencyCode}else{f=0+" "+currencyCode}}if("loan"===o){var h=loanList.getByClient(n[g]["awamoId"]);var m=h.length;if(m>0){var l=0;for(var d=0;d<m;d++){var e=h[d];if(e.status==="ACTIVE"){l=l+e.principal}}f=formatCurrency(l)+" "+currencyCode}else{f=0+" "+currencyCode}}if(f===" "){f="n.a."}s[o]=f}addRow(r,s,n[g],ClientHandler.self.rowClickHandler,n[g].accountId)}var k=getDefaultTableSorter();k.headers={3:{sorter:"awamoDateSorter"},4:{sorter:"awamoDateSorter"}};initialize_datatable(q);var c=document.getElementById("defaultTableContainer").getElementsByTagName("table");for(var g=0;g<c.length;g++){c[g].style.textAlign="right"}$("#tableTotal").text(n.length);showContent($("#tableTotalSum"));showContent($("#emailLoanReportDiv"));if(handlers.Permissions.check_access("_EXPORT_CLIENT_DATA")){var p=$("#defaultTableContainer").tableExport();p.tableExport.update({formats:["xls","xlsx"],fileName:"Clients",headings:true})}$("#hiddenPrintedTitle").val("Clients Report");showPrintButton(exportListName.clients,exportListFilter.all,ClientHandler.ALL_CLIENTS_TITLES);showExcelButton(exportListName.clients,exportListFilter.all,ClientHandler.ALL_CLIENTS_TITLES)};ClientHandler.prototype.manageClientsDisplayClients=function(){ClientHandler.self.currentClient=null;initDefaultContent("All clients");$("#syncNow").off("click touch");$("#syncNow").on("click touch",ClientHandler.self.synchronizeNow);$("#syncNow").attr("title","Sync Clients List");$("#syncNow").show();$("#sendclientEmailReportBotton").off("click touch");$("#sendclientEmailReportBotton").on("click touch",ClientHandler.self.sendEmailLoanReportRequest);$("#sendclientEmailReportBotton").show();var n=clientList.getEntities();var r=getDefaultRowContainer(ClientHandler.ALL_CLIENTS_TITLES,true,"manageClientsTable");var q=r.parent();for(var g=0;g<n.length;g++){var s={};for(var o in ClientHandler.ALL_CLIENTS_TITLES){var f=n[g][o];if("birthdate"===o||"submitDate"===o){f=formatDate(f)}if("account"===o){var b=savingsAccountList.getByClient(n[g]["awamoId"]);var m=b.length;if(m>0){var l=0;for(var d=0;d<m;d++){var a=b[d];l=l+a.balance}f=formatCurrency(l)+" "+currencyCode}else{f=0+" "+currencyCode}}if("loan"===o){var h=loanList.getByClient(n[g]["awamoId"]);var m=h.length;if(m>0){var l=0;for(var d=0;d<m;d++){var e=h[d];if(e.status==="ACTIVE"){l=l+e.principal}}f=formatCurrency(l)+" "+currencyCode}else{f=0+" "+currencyCode}}if(f===" "){f="n.a."}s[o]=f}addRow(r,s,n[g],ClientHandler.self.manageClientRowClickHandler,n[g].accountId)}var k=getDefaultTableSorter();k.headers={3:{sorter:"awamoDateSorter"},4:{sorter:"awamoDateSorter"}};initialize_datatable(q);var c=document.getElementById("defaultTableContainer").getElementsByTagName("table");for(var g=0;g<c.length;g++){c[g].style.textAlign="right"}$("#tableTotal").text(n.length);showContent($("#tableTotalSum"));showContent($("#emailLoanReportDiv"));if(handlers.Permissions.check_access("_EXPORT_CLIENT_DATA")){var p=$("#defaultTableContainer").tableExport();p.tableExport.update({formats:["xls","xlsx"],fileName:"Clients",headings:true})}showPrintButton(exportListName.clients,exportListFilter.all,ClientHandler.ALL_CLIENTS_TITLES);showExcelButton(exportListName.clients,exportListFilter.all,ClientHandler.ALL_CLIENTS_TITLES);$("#hiddenPrintedTitle").val("Clients Report")};ClientHandler.prototype.rowClickHandler=function(){clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();ClientHandler.self.displayOneClient($(this).data("object"))};ClientHandler.prototype.manageClientRowClickHandler=function(){ClientHandler.self.manageClientDisplayOneClient($(this).data("object"))};ClientHandler.prototype.manageClientDisplayOneClient=function(a){if(!exists(a)){return}clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();ClientHandler.self.client=a;initDefaultContent("Edit Client");ClientHandler.self.manageClientDisplayClientData(a);showContent($("#manageClientDiv"))};ClientHandler.prototype.displayClientData=function(a){clearFormValidators($("#manageClientForm"));clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();$("#mainClientFormBackBtn").off("click touch");$("#mainClientFormBackBtn").on("click touch",ClientHandler.prototype.getAll);document.getElementById("clientImageID").src="images/personPlaceholderNoText.png";$("#client .panel-heading").text(a.fullname);$("#clientAwamoId").val(a.awamoId);$("#clientFirstName").val(a.firstname);$("#clientMiddleName").val(a.middlename);$("#clientLastName").val(a.lastname);$("#clientBirthdate").val(formatDate(a.birthdate)+" ("+a.age+" years)");$("#clientNationality").val(a.nationality);$("#clientSubmitdate").val(formatDate(a.submitDate));$.ajax({url:host+"/client/v1d/find?awamoId="+a.awamoId+"&deviceId=cockpit&datatype=PHOTOGRAPHY",type:"GET",headers:getAuthenticationHeader(),xhrFields:{responseType:"arraybuffer"}}).done(function(d){var c=new Blob([d],{type:"image/jpg"});var b=new FileReader();b.onload=function(f){document.getElementById("clientImageID").src=f.target.result};b.readAsDataURL(c)}).fail(function(b){document.getElementById("clientImageID").src="images/personPlaceholderNoText.png";console.log("fail");console.log(b)});$("#clientIdDocumentType").val(a.iddocumenttype);$("#clientIdDocument").val(a.iddocument);$("#clientPhone1").val(a.phone1);$("#clientPhone2").val(a.phone2);$("#clientGender").val(a.gender);$("#clientLocation").val(a.site)};ClientHandler.prototype.displayOneClient=function(a){if(!exists(a)){return}ClientHandler.self.client=a;initDefaultContent("Client");ClientHandler.self.displayClientData(a);ClientHandler.self.displayAccountsData(a);showContent($("#accountsTableContainer"));showContent($("#client"))};ClientHandler.prototype.manageClientDisplayClientData=function(b){clientImage="images/personPlaceholderNoText.png";clearFormValidators($("#manageClientForm"));handlers.Countries.display_nationality_options("manageClientNationality");document.getElementById("manageClientImageID").src="images/personPlaceholderNoText.png";$("#manageClientPanelHeaderText").val(b.fullname);$("#manageClientFirstName").val(b.firstname);$("#manageClientLastName").val(b.lastname);$("#manageClientMiddleName").val(b.middlename);$("#manageClientAge").val("");var c=""+b.age;c=c.toString();if(c.indexOf("NaN")>-1){$("#manageClientBirthdate").val("Select valid date")}else{$("#manageClientBirthdate").val(formatDate(b.birthdate));$("#manageClientBirthdate").tooltip({placement:"bottom"});$("#manageClientBirthdate").attr("title",b.age+" years");$("#manageClientAge").val(b.age+" Years")}$("#manageClientBirthdate").on("change",function(){var f=$("#manageClientBirthdate").val();if(Date.parse(f)){var d=Date.parse(f);var e=calculateAge(d.getMonth(),d.getDate(),d.getFullYear());$("#manageClientAge").val(e+" Years");$("#manageClientBirthdate").attr("title",e+" Years")}});if(b.nationality){var a=b.nationality.toString();a=a.toUpperCase()}$("#manageClientNationality").val(a);$("#manageClientAwamoId").val(b.awamoId);$("#manageClientIdDocumentType").val(b.iddocumenttype);$("#manageClientIdDocument").val(b.iddocument);$("#manageClientPhone1").val(b.phone1);populatePhoneInputFlagAddon($("#manageClientPhone1"),$("#manageClientPhone1CountryBtn"),$("#manageClientPhone1CountryList"));$("#manageClientPhone2").val(b.phone2);populatePhoneInputFlagAddon($("#manageClientPhone2"),$("#manageClientPhone2CountryBtn"),$("#manageClientPhone2CountryList"));$("#manageClientGender").val(b.gender);document.getElementById("manageClientEditImageIDSelector").value="";clientImage="images/personPlaceholderNoText.png";$.ajax({url:host+"/client/v1d/find?awamoId="+b.awamoId+"&deviceId=cockpit&datatype=PHOTOGRAPHY",type:"GET",headers:getAuthenticationHeader(),xhrFields:{responseType:"arraybuffer"}}).done(function(g){var f=new Blob([g],{type:"image/jpg"});var d=new FileReader();d.onload=function(h){clientImage=h.target.result;document.getElementById("manageClientImageID").src=h.target.result};d.readAsDataURL(f)}).fail(function(d){document.getElementById("manageClientImageID").src="images/personPlaceholderNoText.png"});document.getElementById("manageClientCancelSubmitEditBtn").disabled=false;document.getElementById("manageClientConfirmSubmitEditBtn").disabled=false};ClientHandler.prototype.manageClientEditClientImageUpload=function(d){var a=new FileReader();var c=d.target.files[0];var b="";var e="";a.onload=function(g){var f=new Image();f.onload=function(){var i=document.createElement("canvas");f.width=240;f.height=320;var h=i.getContext("2d");h.clearRect(0,0,i.width,i.height);i.width=f.width;i.height=f.height;var j=Math.min(f.width,f.height);h.drawImage(f,0,0,f.width,f.height);e=i.toDataURL("image/jpeg",1);document.getElementById("manageClientImageID").src=i.toDataURL();clientimagecreateformData=new FormData(i.toDataURL("image/jpeg",1))};f.src=g.target.result};a.readAsDataURL(c)};ClientHandler.prototype.handleManageClientCancelEditClientDataButton=function(){$("#manageClientEditBtn").show();$("#manageClientBackEditBtn").show();$("#manageClientCancelEditBtn").hide();$("#manageClientSubmitEditBtn").hide();$("#manageClientBrowseImageBtn").hide();document.getElementById("manageClientEditImageIDSelector").disabled=true;document.getElementById("manageClientFirstName").disabled=true;document.getElementById("manageClientLastName").disabled=true;document.getElementById("manageClientMiddleName").disabled=true;document.getElementById("manageClientBirthdate").disabled=true;document.getElementById("manageClientNationality").disabled=true;document.getElementById("manageClientIdDocumentType").disabled=true;document.getElementById("manageClientIdDocument").disabled=true;document.getElementById("manageClientPhone1").disabled=true;document.getElementById("manageClientPhone2").disabled=true;document.getElementById("manageClientGender").disabled=true};ClientHandler.prototype.handleManageClientEditClientDataButton=function(){$("#manageClientEditBtn").hide();$("#manageClientBackEditBtn").hide();$("#manageClientCancelEditBtn").show();$("#manageClientSubmitEditBtn").show();$("#manageClientBrowseImageBtn").show();document.getElementById("manageClientBrowseImageBtn").style.margin="auto";document.getElementById("manageClientBrowseImageBtn").style.display="block";document.getElementById("manageClientEditImageIDSelector").disabled=false;document.getElementById("manageClientFirstName").disabled=false;document.getElementById("manageClientLastName").disabled=false;document.getElementById("manageClientMiddleName").disabled=false;document.getElementById("manageClientBirthdate").disabled=false;document.getElementById("manageClientNationality").disabled=false;document.getElementById("manageClientIdDocumentType").disabled=false;document.getElementById("manageClientIdDocument").disabled=false;document.getElementById("manageClientPhone1").disabled=false;document.getElementById("manageClientPhone2").disabled=false;document.getElementById("manageClientGender").disabled=false;clearFormValidators($("#manageClientForm"));registerKeyPressValidators($("#manageClientForm"))};ClientHandler.prototype.submitManageClientDataToServer=function(){var a='{"idDocument":"'+$("#manageClientIdDocument").val()+'","idDocumentType":"'+$("#manageClientIdDocumentType").val()+'","awamoId":"'+$("#manageClientAwamoId").val()+'"}';validateClientDocument(a,function(e){if(!e){clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();if(document.getElementById("manageClientFirstName").checkValidity()&&document.getElementById("manageClientLastName").checkValidity()&&document.getElementById("manageClientBirthdate").checkValidity()&&document.getElementById("manageClientNationality").checkValidity()&&document.getElementById("manageClientIdDocumentType").checkValidity()&&document.getElementById("manageClientIdDocument").checkValidity()&&document.getElementById("manageClientPhone1").checkValidity()&&document.getElementById("manageClientGender").checkValidity()){if(!($("#manageClientIdDocumentType").val().toString()==="NONE")&&$("#manageClientIdDocument").val().toString().length<3){console.log("valid client form invalid id doc stuff");showAlertMessage("Please provide a valid ID document number",AlertTypes.danger)}else{var c="Confirm Client Update";var f="Are you sure you want to edit this client with the provided details";var d="Yes";var b="No";showDialogPopupWithHandlers(c,f,d,function(){ClientHandler.prototype.handleManageClientConfirmSubmitEditClientDataButton()},b,function(){$("#manageClientEditBtn").hide();$("#manageClientBackEditBtn").hide();$("#manageClientCancelEditBtn").show();$("#manageClientSubmitEditBtn").show();$("#manageClientConfirmSubmitEditBtn").hide();$("#manageClientCancelSubmitEditBtn").hide();$("#manageClientBrowseImageBtn").show();document.getElementById("manageClientBrowseImageBtn").style.margin="auto";document.getElementById("manageClientBrowseImageBtn").style.display="block";document.getElementById("manageClientEditImageIDSelector").disabled=false;document.getElementById("manageClientFirstName").disabled=false;document.getElementById("manageClientLastName").disabled=false;document.getElementById("manageClientBirthdate").disabled=false;document.getElementById("manageClientNationality").disabled=false;document.getElementById("manageClientIdDocumentType").disabled=false;document.getElementById("manageClientIdDocument").disabled=false;document.getElementById("manageClientPhone1").disabled=false;document.getElementById("manageClientPhone2").disabled=false;document.getElementById("manageClientGender").disabled=false})}}else{console.log("outside not okay client form");showAlertMessage("Some of the fields have invalid data, Please verify them and try again",AlertTypes.warning);$("#manageClientEditBtn").hide();$("#manageClientBackEditBtn").hide();$("#manageClientCancelEditBtn").show();$("#manageClientSubmitEditBtn").show();$("#manageClientConfirmSubmitEditBtn").hide();$("#manageClientCancelSubmitEditBtn").hide();$("#manageClientBrowseImageBtn").show();document.getElementById("manageClientBrowseImageBtn").style.margin="auto";document.getElementById("manageClientBrowseImageBtn").style.display="block";document.getElementById("manageClientEditImageIDSelector").disabled=false;document.getElementById("manageClientFirstName").disabled=false;document.getElementById("manageClientLastName").disabled=false;document.getElementById("manageClientBirthdate").disabled=false;document.getElementById("manageClientNationality").disabled=false;document.getElementById("manageClientIdDocumentType").disabled=false;document.getElementById("manageClientIdDocument").disabled=false;document.getElementById("manageClientPhone1").disabled=false;document.getElementById("manageClientPhone2").disabled=false;document.getElementById("manageClientGender").disabled=false}}else{showAlertMessage("Provide another ID Document, this one has already been used by another client",AlertTypes.danger)}})};ClientHandler.prototype.handleManageClientSubmitEditClientDataButton=function(){if(validateForm($("#manageClientForm"))){if($("#manageClientPhone1").val()===$("#manageClientPhone2").val()){showAlertMessage("Phone number 1 and 2 should not be the same",AlertTypes.danger)}else{showLoader("Validating Phone1 input");validatePhoneInput(("#manageClientPhone1"),function(){hideLoader();if($("#manageClientPhone2").val().length>0){showLoader("Validating Phone2 input");validatePhoneInput(("#manageClientPhone2"),function(){hideLoader();ClientHandler.prototype.submitManageClientDataToServer()},function(){hideLoader();showAlertMessage("Invalid Phone 2 input",AlertTypes.danger)})}else{ClientHandler.prototype.submitManageClientDataToServer()}},function(){hideLoader();showAlertMessage("Invalid Phone 1 input",AlertTypes.danger)})}}else{showAlertMessage("Please ensure all the elements are filled in correctly",AlertTypes.danger)}};ClientHandler.prototype.handleManageClientCancelSubmitEditClientDataButton=function(){initDefaultContent("Edit Client");showContent($("#manageClientDiv"));clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();$("#manageClientEditBtn").hide();$("#manageClientBackEditBtn").hide();$("#manageClientCancelEditBtn").show();$("#manageClientSubmitEditBtn").show();$("#manageClientConfirmSubmitEditBtn").hide();$("#manageClientCancelSubmitEditBtn").hide();$("#manageClientBrowseImageBtn").show();document.getElementById("manageClientBrowseImageBtn").style.margin="auto";document.getElementById("manageClientBrowseImageBtn").style.display="block";document.getElementById("manageClientEditImageIDSelector").disabled=false;document.getElementById("manageClientFirstName").disabled=false;document.getElementById("manageClientLastName").disabled=false;document.getElementById("manageClientBirthdate").disabled=false;document.getElementById("manageClientNationality").disabled=false;document.getElementById("manageClientIdDocumentType").disabled=false;document.getElementById("manageClientIdDocument").disabled=false;document.getElementById("manageClientPhone1").disabled=false;document.getElementById("manageClientPhone2").disabled=false;document.getElementById("manageClientGender").disabled=false};ClientHandler.prototype.handleManageClientConfirmSubmitEditClientDataButton=function(){var d=getAuthenticationHeader();var b="/client/v1d/update";var a='{"firstname":"'+$("#manageClientFirstName").val()+'","lastname":"'+$("#manageClientLastName").val()+'","nationality":"'+$("#manageClientNationality").val()+'","iddocumenttype":"'+$("#manageClientIdDocumentType").val()+'","iddocument":"'+$("#manageClientIdDocument").val()+'","phone1":"'+$("#manageClientPhone1").val()+'","gender":"'+$("#manageClientGender").val()+'","awamoId":"'+$("#manageClientAwamoId").val()+'","site":"MFI_OFFICE"}';var c=JSON.parse(a);if(!(typeof manageClientEditedBirthDate==="undefined")){c.birthdate=manageClientEditedBirthDate}else{c.birthdate=ClientHandler.self.client.birthdate}if($("#manageClientPhone2").val().toString().length>1){c.phone2=$("#manageClientPhone2").val()}if($("#manageClientMiddleName").val().toString().length>1){c.middlename=$("#manageClientMiddleName").val()}a=JSON.stringify(c);showLoader();$.ajax({url:host+b,data:a,dataType:"json",contentType:"application/json; charset=utf-8",headers:d,type:"POST",beforeSend:function(){document.getElementById("manageClientCancelSubmitEditBtn").disabled=true;document.getElementById("manageClientConfirmSubmitEditBtn").disabled=true},success:function(g){if(!($("#manageClientEditImageIDSelector").get(0).files.length===0)){var e=$("#manageClientEditImageIDSelector").prop("files")[0];var f=new FormData();f.append("payload",e);f.append("datatype","PHOTOGRAPHY");f.append("deviceId","CockpitUI");f.append("authentication",authentication);f.append("tenantId",tenantId);f.append("awamoId",$("#manageClientAwamoId").val());$.ajax({url:host+"/client/v1d/upload",data:f,contentType:false,processData:false,type:"POST",success:function(h){showAlertMessage("The client has been successfully updated",AlertTypes.success);ClientHandler.prototype.handleManageClientSuccessfulEditOperation()}}).fail(function(h){showAlertMessage("Client information updated, but failed to upload the Profile Image",AlertTypes.warning);ClientHandler.prototype.handleManageClientFailedImageUploadOperation()})}else{showAlertMessage("The client has been successfully updated",AlertTypes.success);ClientHandler.prototype.handleManageClientSuccessfulEditOperation()}},complete:function(){document.getElementById("manageClientCancelSubmitEditBtn").disabled=false;document.getElementById("manageClientConfirmSubmitEditBtn").disabled=false}}).fail(function(e){showAlertMessage("Client update failed, please contact support",AlertTypes.danger);ClientHandler.prototype.handleManageClientFailedEditOperation()})};ClientHandler.prototype.updatedLocalClientObjectWithNewProperties=function(){ClientHandler.self.client.firstname=$("#manageClientFirstName").val();ClientHandler.self.client.middlename=$("#manageClientMiddleName").val();ClientHandler.self.client.lastname=$("#manageClientLastName").val();if(!(typeof manageClientEditedBirthDate==="undefined")){ClientHandler.self.client.birthdate=manageClientEditedBirthDate}ClientHandler.self.client.nationality=$("#manageClientNationality").val();ClientHandler.self.client.awamoId=$("#manageClientAwamoId").val();ClientHandler.self.client.iddocumenttype=$("#manageClientIdDocumentType").val();ClientHandler.self.client.iddocument=$("#manageClientIdDocument").val();ClientHandler.self.client.phone2=$("#manageClientPhone2").val();ClientHandler.self.client.phone1=$("#manageClientPhone1").val();ClientHandler.self.client.gender=$("#manageClientGender").val();clientList.put(clientList,ClientHandler.self.client)};ClientHandler.prototype.insertNewLocalClientObject=function(c,a){var b=new Object();console.log("in insert mtd");console.log("in insert mtd "+c);b.awamoId=c;b.firstname=$("#clientCreateF").val();b.lastname=$("#clientCreateL").val();b.middlename=$("#clientCreateM").val();b.nationality=$("#clientCreateN").val();b.iddocumenttype=$("#clientCreateIdDocumentType").val();b.iddocument=$("#clientCreateIdDocument").val();b.phone1=$("#clientCreateP1").val();b.phone2=$("#clientCreateP2").val();b.gender=$("#clientCreateG").val();console.log("in insert mt3");if(!(typeof a==="undefined")){console.log("in insert mtd3 : "+a);b.birthdate=a}if(exists(clientList)){console.log("in store mtd");clientList.store(b)}};ClientHandler.prototype.handleManageClientFailedImageUploadOperation=function(){ClientHandler.self.manageClientsDisplayClients();$("#manageClientEditBtn").show();$("#manageClientBackEditBtn").show();$("#manageClientCancelEditBtn").hide();$("#manageClientSubmitEditBtn").hide();$("#manageClientConfirmSubmitEditBtn").hide();$("#manageClientCancelSubmitEditBtn").hide();$("#manageClientBrowseImageBtn").hide();document.getElementById("manageClientEditImageIDSelector").disabled=true;document.getElementById("manageClientFirstName").disabled=true;document.getElementById("manageClientLastName").disabled=true;document.getElementById("manageClientBirthdate").disabled=true;document.getElementById("manageClientNationality").disabled=true;document.getElementById("manageClientIdDocumentType").disabled=true;document.getElementById("manageClientIdDocument").disabled=true;document.getElementById("manageClientPhone1").disabled=true;document.getElementById("manageClientGender").disabled=true;hideLoader()};ClientHandler.prototype.handleManageClientSuccessfulEditOperation=function(){ClientHandler.prototype.updatedLocalClientObjectWithNewProperties();ClientHandler.self.manageClientsDisplayClients();$("#manageClientEditBtn").show();$("#manageClientBackEditBtn").show();$("#manageClientCancelEditBtn").hide();$("#manageClientSubmitEditBtn").hide();$("#manageClientConfirmSubmitEditBtn").hide();$("#manageClientCancelSubmitEditBtn").hide();$("#manageClientBrowseImageBtn").hide();document.getElementById("manageClientEditImageIDSelector").disabled=true;document.getElementById("manageClientFirstName").disabled=true;document.getElementById("manageClientLastName").disabled=true;document.getElementById("manageClientBirthdate").disabled=true;document.getElementById("manageClientNationality").disabled=true;document.getElementById("manageClientIdDocumentType").disabled=true;document.getElementById("manageClientIdDocument").disabled=true;document.getElementById("manageClientPhone1").disabled=true;document.getElementById("manageClientGender").disabled=true;hideLoader()};ClientHandler.prototype.handleManageClientFailedEditOperation=function(){showContent($("#manageClientDiv"));$("#manageClientEditBtn").show();$("#manageClientBackEditBtn").show();$("#manageClientCancelEditBtn").hide();$("#manageClientSubmitEditBtn").hide();$("#manageClientConfirmSubmitEditBtn").hide();$("#manageClientCancelSubmitEditBtn").hide();$("#manageClientBrowseImageBtn").hide();document.getElementById("manageClientEditImageIDSelector").disabled=true;document.getElementById("manageClientFirstName").disabled=true;document.getElementById("manageClientLastName").disabled=true;document.getElementById("manageClientBirthdate").disabled=true;document.getElementById("manageClientNationality").disabled=true;document.getElementById("manageClientIdDocumentType").disabled=true;document.getElementById("manageClientIdDocument").disabled=true;document.getElementById("manageClientPhone1").disabled=true;document.getElementById("manageClientGender").disabled=true;hideLoader()};ClientHandler.prototype.custManageClientsMenuRowClickHandler=function(){var b=$(this).data("id");var a=$(this).data("object");$('li[data-parent~="manageClients"][data-handler="'+a+'"][data-action~="'+b+'"] a').click()};ClientHandler.prototype.displayAccountsData=function(c){var j=getRowContainer("#accountsTableContainer",ClientHandler.ACCOUNTS_TITLES,true);var h=j.parent();var b=savingsAccountList.getByClient(c.awamoId);if(!exists(b)||b.length===0){$("#defaultDataTable",$("#accountsTableContainer")).css("display","none");$("#accountsTableContainer").siblings(".no-info-to-display").removeClass("hidden");return}else{$("#accountsTableContainer").siblings(".no-info-to-display").addClass("hidden")}var f=b.length;for(var d=0;d<f;d++){var a=b[d];var g=ClientHandler.prototype._getAccountsRowData(a);addRow(j,g,a,ClientHandler.self._accountsRowClickHandler,a.accountId)}var e=getDefaultTableSorter();e.headers={3:{sorter:"awamoPercentageSorter"},4:{sorter:"awamoCurrencySorter"}};initialize_datatable(h);addClassToTableColumn(h,3,"percentage");addClassToTableColumn(h,4,"currency")};ClientHandler.prototype._getAccountsRowData=function(c){var d={};for(var a in ClientHandler.ACCOUNTS_TITLES){var b=c[a];switch(a){case"type":b="savings account";break;case"interestRate":b=formatPercentage(b)+" %";break;case"balance":b=formatCurrency(b)+" "+currencyCode;break;default:break}d[a]=String(b)}return d};ClientHandler.prototype._accountsRowClickHandler=function(){var b=$(this).data("object");var c=handlers.SavingsAccount;var a={currentTarget:{}};$(a.currentTarget).data("object",b);c.rowClickHandler(a,function(){ClientHandler.self.displayOneClient(ClientHandler.self.client)})};ClientHandler.prototype._singleClientActionHandler=function(a){a.preventDefault();hideContent();switch($(this).data("action")){case"back":ClientHandler.self.previousPage();break;default:break}};ClientHandler.prototype.outputClient=function(b){var a=null;var c=clientList.getTotalCount();if("allClients"===currentTable){}else{}return a};ClientHandler.prototype.entityChanged=function(a){ClientHandler.self.outputClient(a)};ClientHandler.prototype.synchronizeNow=function(){clientList.reload()};ClientHandler.prototype.sendEmailLoanReportRequest=function(){var c={tenantId:tenantId};var b="/tenant/v1d/mis/reportEmail";var a='{"startTime":"0","endTime":"0","reportEmailEntity":"CLIENT","reportEmailType":"ALL","email":"'+$("#emailReportC").val()+'"}';ajax(b,"POST",ClientHandler.prototype.emailReportResponseHandler,a,c,ClientHandler.prototype.emailReportFailedResponseHandler)};ClientHandler.prototype.emailReportResponseHandler=function(a){message("Success","Message Sent Successfully",MessageType.SUCCESS)};ClientHandler.prototype.emailReportFailedResponseHandler=function(a){message("Error",a.responseJSON.message,MessageType.WARNING)};ClientHandler.prototype.getAllClientsForLoanApplication=function(){$("html, body").animate({scrollTop:0},"fast");addHistory("All clients","#clients",getSidebarSubitemSelector("individualLoans","Client","getAllClientsForLoanApplication"));currentTable="allClientsLoanApplication";ClientHandler.self.previousPage=ClientHandler.self.getAll;ClientHandler.self.displayClientsForLoanApplication()};ClientHandler.prototype.displayClientsForLoanApplication=function(){ClientHandler.self.currentClient=null;initDefaultContent("Select a client to start creating a loan application");$("#syncNow").off("click touch");$("#syncNow").on("click touch",ClientHandler.self.synchronizeNow);$("#syncNow").show();var n=clientList.getEntities();var q=getDefaultRowContainer(ClientHandler.ALL_CLIENTS_TITLES,true,"manageClientsTable");var p=q.parent();for(var g=0;g<n.length;g++){var r={};for(var o in ClientHandler.ALL_CLIENTS_TITLES){var f=n[g][o];if("birthdate"===o||"submitDate"===o){f=formatDate(f)}if("account"===o){var b=savingsAccountList.getByClient(n[g]["awamoId"]);var m=b.length;if(m>0){var l=0;for(var d=0;d<m;d++){var a=b[d];l=l+a.balance}f=formatCurrency(l)+" "+currencyCode}else{f=0+" "+currencyCode}}if("loan"===o){var h=loanList.getByClient(n[g]["awamoId"]);var m=h.length;if(m>0){var l=0;for(var d=0;d<m;d++){var e=h[d];if(e.status==="ACTIVE"){l=l+e.principal}}f=formatCurrency(l)+" "+currencyCode}else{f=0+" "+currencyCode}}if(f===" "){f="n.a."}r[o]=f}addRow(q,r,n[g],ClientHandler.self.rowClickHandlerClientsForLoanApplication,n[g].accountId)}var k=getDefaultTableSorter();k.headers={3:{sorter:"awamoDateSorter"},4:{sorter:"awamoDateSorter"}};initialize_datatable(p);var c=document.getElementById("defaultTableContainer").getElementsByTagName("table");for(var g=0;g<c.length;g++){c[g].style.textAlign="right"}$("#tableTotal").text(n.length);showContent($("#tableTotalSum"));showContent($("#emailLoanReportDiv"));$("#hiddenPrintedTitle").val("Select a client to start creating a loan application")};ClientHandler.prototype.rowClickHandlerClientsForLoanApplication=function(){Options.prototype.createLoanApplication($(this).data("object"),"INDIVIDUAL")};