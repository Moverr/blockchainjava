var ProductsHandler=function(){ProductsHandler.self=this};ProductsHandler.DISPLAY_SHAREPRODUCT_TITLES={fullname:"Name",parentOffice:"Short name ",date_created:" Total Shares "};ProductsHandler.prototype.shareproducts_sub_menu=function(){addHistory("Share Products overview","#sharesProducts","#sharesProducts");initDefaultContent("Share Products Overview");clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();currentTable="ShareProductsOverview";var a=getDefaultRowContainer({type:"Items Available"});addRow(a,{type:"Manage Share Products "},"Products",ProductsHandler.self.manageShareProducts,"manageShareProducts");addRow(a,{type:"Add Share Product "},"Products",ProductsHandler.self.addShareProducts,"addShareProducts")};ProductsHandler.prototype.getShareProductDataList=function(){var a=null;a=shareProductList.getEntities();return a.length>1?a:null};ProductsHandler.prototype.manageShareProducts=function(){OfficeHandler.self.currentOffice=null;initDefaultContent("Share Products  ");$("#printNow").off("click touch");$("#printNow").on("click touch",printData);$("#printNow").show();$("#create_object").off("click touch");$("#create_object").text("Create Product  ");$("#create_object").on("click touch",ProductsHandler.self.addShareProducts);$("#create_object").show();var e=ProductsHandler.self.getShareProductDataList();var h=getDefaultRowContainer(ProductsHandler.DISPLAY_SHAREPRODUCT_TITLES,true);var g=h.parent();for(var c=0;c<e.length;c++){var j={};var b=e[c];j.name=b.name;j.shortName=b.shortName;j.totalShares=b.totalShares;addRow(h,j,e[c],ProductsHandler.self.editShareProduct,e[c].id)}var d=getDefaultTableSorter();d.headers={3:{sorter:"awamoDateSorter"},4:{sorter:"awamoDateSorter"}};initialize_datatable(g);var a=document.getElementById("defaultTableContainer").getElementsByTagName("table");for(var c=0;c<a.length;c++){a[c].style.textAlign="right"}$("#tableTotal").text(e.length);showContent($("#tableTotalSum"));showContent($("#emailLoanReportDiv"));var f=$("#defaultTableContainer").tableExport();f.tableExport.update({formats:["xls","xlsx"],fileName:"Share Products"+(new Date().toJSON().slice(0,10).replace(/-/g,"_")),headings:true});$("#hiddenPrintedTitle").val("Users Report")};ProductsHandler.prototype.addShareProducts=function(){initDefaultContent(" Share Product  ");hideContent();$("#_createNewShareProduct").off();$("#_createNewShareProduct").on("submit",ProductsHandler.self.submitShareProduct);$("#submitShareProductbtn").val("submit");$("#backtoShareProductsbtn").off();$("#backtoShareProductsbtn").on("click",ProductsHandler.self.manageShareProducts);var b="<option value='"+currencyCode+"' selected >"+currencyCode+"</option>";$("#shareproductcurrency").html(b);var a=handlers.Accounting.getChartofAccountsByType("ASSET");var d="";d+="<option   value=''  >  Select an Option  </option>";if(a!=undefined&&a!=null){for(var c=0;c<a.length;c++){d+="<option title=' "+a[c].name+"'   value='"+a[c].accountId+"' id='"+a[c].accountId+"'  > "+a[c].name+" </option>"}}$("#shares_reference").html(d);a=handlers.Accounting.getChartofAccountsByType("LIABILITY");d="";d+="<option   value=''  >  Select an Option  </option>";if(a!=undefined&&a!=null){for(var c=0;c<a.length;c++){d+="<option title=' "+a[c].name+"'   value='"+a[c].accountId+"' id='"+a[c].accountId+"'  > "+a[c].name+" </option>"}}$("#shares_suspense_control").html(d);a=handlers.Accounting.getChartofAccountsByType("EQUITY");d="";d+="<option   value=''  >  Select an Option  </option>";if(a!=undefined&&a!=null){for(var c=0;c<a.length;c++){d+="<option title=' "+a[c].name+"'   value='"+a[c].accountId+"' id='"+a[c].accountId+"'  > "+a[c].name+" </option>"}}$("#shares_equity").html(d);a=handlers.Accounting.getChartofAccountsByType("INCOME");d="";d+="<option   value=''  >  Select an Option  </option>";if(a!=undefined&&a!=null){for(var c=0;c<a.length;c++){d+="<option title=' "+a[c].name+"'   value='"+a[c].accountId+"' id='"+a[c].accountId+"'  > "+a[c].name+" </option>"}}$("#income_from_fees").html(d);$(".shareproductaccountingRule").on("click",ProductsHandler.self.manage_accounting_rule);showContent($("#createshareproduct_template_page"));ProductsHandler.self.manage_accounting_rule()};ProductsHandler.prototype.manage_accounting_rule=function(){var a=$("input[name='shareproductaccountingRule']:checked").val();$("#shares_reference").removeAttr("required");$("#shares_suspense_control").removeAttr("required");$("#income_from_fees").removeAttr("required");$("#shares_equity").removeAttr("required");switch(parseInt(a)){case 1:$(".cash_level_accounting").fadeOut("fast");break;case 2:$("#shares_reference").attr("required","required");$("#shares_suspense_control").attr("required","required");$("#income_from_fees").attr("required","required");$("#shares_equity").attr("required","required");$(".cash_level_accounting").fadeIn("fast");break;default:$(".cash_level_accounting").fadeOut("fast");break}};ProductsHandler.prototype.submitShareProduct=function(x){x.preventDefault();var k=$("#share_product_name").val();var a=$("#share_product_shortname").val();var v=$("#share_product_description").val();var o=$("#shareproductcurrency").val();var h=$("#shareproductmultiplesof").val();var m=$("#shareproductdecimalplaces").val();var q=$("#shareproducttotalnumberofshares").val();var d=$("#shareproductsharestobeissued").val();var s=$("#shareproductnominalprice").val();var r=$("#shareproductsharesperclient_minimum").val();var u=$("#shareproductsharesperclient_default").val();var t=$("#shareproductsharesperclient_maximum").val();var c=$("#shareproductminimumactiveperiod").val();var z=$("#shareproductminimumactiveperiod_option").val();var g=$("#shareproductlockinperiod").val();var l=$("#shareproductlockinperiod_option").val();var f=$("#shareproductallowdividends:checkbox:checked").length>0?true:false;var n=$("input[name='shareproductaccountingRule']:checked").val();var y=$("#sharesMaketPrice").val();if((k.trim().length<=0)||(a.trim().length<=0)||(v.trim().length<=0)||(o.trim().length<=0)||(h.trim().length<=0)||(m.trim().length<=0)||(q.trim().length<=0)||(d.trim().length<=0)||(s.trim().length<=0)||(r.trim().length<=0)||(u.trim().length<=0)||(t.trim().length<=0)||(n.trim().length<=0)||(y.trim().length<=0)){showAlertMessage("Fill Mandatory Fields",AlertTypes.warning);return}if(parseInt(q)<parseInt(d)){showAlertMessage("Shares Issued can not be greater than Total Number of Shares",AlertTypes.warning);return}if((isEmpty(c)===false&&isEmpty(z)===true)||(isEmpty(c)===true&&isEmpty(z)===false)){showAlertMessage("Check Minimum Active Period",AlertTypes.warning);return}if((isEmpty(g)===false&&isEmpty(l)===true)||(isEmpty(g)===true&&isEmpty(l)===false)){showAlertMessage("Check Lockin Period",AlertTypes.warning);return}if(parseInt(r)>parseInt(d)){showAlertMessage("Minimum shares per client can not be greater than total issued shares  ",AlertTypes.warning);return}if(parseInt(u)>parseInt(d)){showAlertMessage("Default shares per client can not be greater  than total issued shares ",AlertTypes.warning);return}if(parseInt(u)<parseInt(r)){showAlertMessage("Default shares per client can not be greater  than minimum shares per client  ",AlertTypes.warning);return}if(parseInt(t)<parseInt(u)){showAlertMessage("Maximum shares per client can not be less  than default shares per client  ",AlertTypes.warning);return}if(parseInt(t)>parseInt(d)){showAlertMessage("Maximum shares per client can not be greater  than total issued shares  ",AlertTypes.warning);return}var p=" {";switch(parseInt(n)){case 2:var j=$("#shares_reference").val();var w=$("#shares_suspense_control").val();var b=$("#shares_equity").val();var i=$("#income_from_fees").val();if((isEmpty(j)===false)||(isEmpty(w)===false)||(isEmpty(b)===false)||(isEmpty(i)===false)){showAlertMessage("Accounting Section is Mandatory for this accounting type",AlertTypes.warning);return}break;case 1:break;default:break}p+='"name":"'+k+'","shortName":"'+a+'","description":"'+v+'","currencyCode":"'+currencyCode+'","currencyDigits":'+m+', "currencyMultiplesof":'+h+' , "totalShares":'+q+',"issuedShares":'+d+',"unitPrice":'+s+',"capitalAmount":'+(parseFloat(s)*parseFloat(s))+',"minimumClientShares":'+r+',"nominalClientShares":'+u+',"maximumClientShares":'+t+',"accountingRule": '+n+" ,";if(isEmpty(c)===true&&isEmpty(z)===true){p+='"minimumActivePeriodFrequency":"'+c+'",';p+='"minimumActivePeriodFrequencyEnum":"'+z+'",'}if(isEmpty(c)===true&&isEmpty(z)===true){p+='"lockinPeriodFrequency":"'+c+'",';p+='"lockinPeriodFrequencyEnum":"'+z+'",'}if((isEmpty(j)===true)||(isEmpty(w)===true)||(isEmpty(b)===true)||(isEmpty(i)===true)){p+='"shares_reference":"'+j+'",';p+='"shares_suspense":"'+w+'",';p+='"shares_equity":"'+b+'",';p+='"income_from_fees":"'+i+'",'}p+='"marketprice": '+y+" ";p+=" }";headers=getAuthenticationHeader();console.log(p);$.ajax({url:host+"/shareproduct/v1d/",data:p,dataType:"json",contentType:"application/json; charset=utf-8",headers:headers,type:"POST",beforeSend:function(){showLoader()},success:function(e){showAlertMessage("Record Saved Successfully",AlertTypes.success);hideLoader()},complete:function(){hideLoader()}}).fail(function(e){if(e.status===403){showAlertMessage("Record was not saved Correctly ",AlertTypes.warning)}else{if(e.status===500){showAlertMessage("Something went wrong, if persists contact Server Admin",AlertTypes.danger)}else{if(e.status===404){showAlertMessage("Check Your Network Connection",AlertTypes.danger)}else{showAlertMessage("Something went Wrong contact Administrator ",AlertTypes.danger)}}}hideLoader()});console.log(f);console.log(n)};ProductsHandler.prototype.editShareProduct=function(c){initDefaultContent(" Share Product  ");hideContent();var d=$(c.currentTarget).data("object");console.log("Product");console.log(d);$("#share_product_name").val(d.name);$("#share_product_shortname").val(d.shortName);$("#share_product_description").val(d.description);$("#shareproductmultiplesof").val(d.currencyMultiplesof);$("#shareproducttotalnumberofshares").val(d.totalShares);$("#shareproductsharestobeissued").val(d.issueShares);$("#shareproductnominalprice").val(d.unitPrice);$("#_createNewShareProduct").off();$("#_createNewShareProduct").on("submit",ProductsHandler.self.submitShareProduct);$("#submitShareProductbtn").val("edit");$("#backtoShareProductsbtn").off();$("#backtoShareProductsbtn").on("click",ProductsHandler.self.manageShareProducts);var b="<option value='"+currencyCode+"' selected >"+currencyCode+"</option>";$("#shareproductcurrency").html(b);var a=handlers.Accounting.getChartofAccountsByType("ASSET");var f="";f+="<option   value=''  >  Select an Option  </option>";if(a!=undefined&&a!=null){for(var e=0;e<a.length;e++){f+="<option title=' "+a[e].name+"'   value='"+a[e].accountId+"' id='"+a[e].accountId+"'  > "+a[e].name+" </option>"}}$("#shares_reference").html(f);a=handlers.Accounting.getChartofAccountsByType("LIABILITY");f="";f+="<option   value=''  >  Select an Option  </option>";if(a!=undefined&&a!=null){for(var e=0;e<a.length;e++){f+="<option title=' "+a[e].name+"'   value='"+a[e].accountId+"' id='"+a[e].accountId+"'  > "+a[e].name+" </option>"}}$("#shares_suspense_control").html(f);a=handlers.Accounting.getChartofAccountsByType("EQUITY");f="";f+="<option   value=''  >  Select an Option  </option>";if(a!=undefined&&a!=null){for(var e=0;e<a.length;e++){f+="<option title=' "+a[e].name+"'   value='"+a[e].accountId+"' id='"+a[e].accountId+"'  > "+a[e].name+" </option>"}}$("#shares_equity").html(f);a=handlers.Accounting.getChartofAccountsByType("INCOME");f="";f+="<option   value=''  >  Select an Option  </option>";if(a!=undefined&&a!=null){for(var e=0;e<a.length;e++){f+="<option title=' "+a[e].name+"'   value='"+a[e].accountId+"' id='"+a[e].accountId+"'  > "+a[e].name+" </option>"}}$("#income_from_fees").html(f);$(".shareproductaccountingRule").on("click",ProductsHandler.self.manage_accounting_rule);showContent($("#createshareproduct_template_page"));ProductsHandler.self.manage_accounting_rule()};