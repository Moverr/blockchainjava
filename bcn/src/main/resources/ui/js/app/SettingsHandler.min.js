"use strict";var userCreationBodyDetails;var userEditBodyDetails;var SettingsHandler=function(){SettingsHandler.self=this};SettingsHandler.prototype.system_users_list=null;SettingsHandler.prototype.init=function(){SettingsHandler.self.fetch_system_users()};SettingsHandler.prototype.fetch_system_users=function(){var a=getAuthenticationHeader();$.ajax({url:host+"/user/v1d/list",dataType:"json",headers:a,type:"GET",beforeSend:function(){},success:function(b){SettingsHandler.self.system_users_list=b;return},complete:function(){}}).fail(function(b){if(b.status===403){}else{if(b.status===500){}else{}}})};SettingsHandler.prototype.rowClickHandler=function(){var b=$(this).data("id");var a=$(this).data("object");$('li[data-parent~="settings"][data-handler="'+a+'"][data-action~="'+b+'"] a').click()};SettingsHandler.prototype.overview=function(){addHistory("Settings overview","#settingsOverview","#settings");initDefaultContent("Settings");clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();currentTable="settings";var a=getDefaultRowContainer({type:"Items available"});addRow(a,{type:"Offices & Branches"},"Settings",SettingsHandler.self.rowClickHandler,"offices_sub_menu");addRow(a,{type:"Roles & Permissions "},"Settings",SettingsHandler.self.rowClickHandler,"roles_sub_menu");addRow(a,{type:"Users"},"Settings",SettingsHandler.self.rowClickHandler,"users_sub_menu")};SettingsHandler.prototype.roles_sub_menu=function(){addHistory("Settings Roles Overview","#settingsRolesOverview",getSidebarSubitemSelector("settings","Settings","roles_sub_menu"));clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();initDefaultContent("Roles & Permissions ");currentTable="rolesMenu";var a=getDefaultRowContainer({type:"Items available"});addRow(a,{type:"Create Role "},"Settings",SettingsHandler.self.add_role,"_create_role");addRow(a,{type:"Manage Roles"},"Settings",SettingsHandler.self.manage_roles,"_manage_roles")};SettingsHandler.prototype.offices_sub_menu=function(){addHistory("Settings Offices Overview","#settingsOfficesOverview",getSidebarSubitemSelector("settings","Settings","offices_sub_menu"));initDefaultContent("Offices");currentTable="officesMenu";var a=getDefaultRowContainer({type:"Items available"});addRow(a,{type:"Create Office "},"Settings",SettingsHandler.self.create_office,"_create_office");addRow(a,{type:"Manage Offices"},"Settings",SettingsHandler.self.manage_offices,"_manage_offices")};SettingsHandler.prototype.users_sub_menu=function(){addHistory("Settings Users Overview","#settingsUsersOverview",getSidebarSubitemSelector("settings","Settings","users_sub_menu"));initDefaultContent("Users");currentTable="usersMenu";var a=getDefaultRowContainer({type:"Items available"});addRow(a,{type:"Create User "},"Settings",SettingsHandler.self.add_user,"_create_user");addRow(a,{type:"Edit User"},"Settings",SettingsHandler.self.manage_users,"_manage_users")};SettingsHandler.prototype.manage_offices=function(){currentTable="offices";handlers.Offices.display_offices()};SettingsHandler.prototype.create_office=function(){handlers.Offices.add_office()};SettingsHandler.prototype.manage_users=function(){currentTable="SystemUsers";SettingsHandler.self.display_users()};SettingsHandler.DISPLAY_USER_TITLES={fullname:"Name",gender:"Office",birthdate:"Role"};SettingsHandler.prototype.display_users=function(){SettingsHandler.self.currentClient=null;initDefaultContent("System Users ");$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").on("click touch",printData);$("#printableTitle").text("Users");$("#printNow").show();$("#create_object").off("click touch");$("#create_object").text("Create User ");$("#create_object").on("click touch",SettingsHandler.self.add_user);$("#create_object").show();var e=SettingsHandler.self.system_users_list;var h=getDefaultRowContainer(SettingsHandler.DISPLAY_USER_TITLES,true);var g=h.parent();for(var c=0;c<e.length;c++){var j={};var b=e[c];j.name=b.firstname+" "+b.lastname;j.officename=b.officeName;j.satff_role=b.selectedRoles[0].name;addRow(h,j,e[c],SettingsHandler.self.view_user,e[c].id)}var d=getDefaultTableSorter();d.headers={3:{sorter:"awamoDateSorter"},4:{sorter:"awamoDateSorter"}};initialize_datatable(g);var a=document.getElementById("defaultTableContainer").getElementsByTagName("table");for(var c=0;c<a.length;c++){a[c].style.textAlign="right"}$("#tableTotal").text(e.length);showContent($("#tableTotalSum"));showContent($("#emailLoanReportDiv"));var f=$("#defaultTableContainer").tableExport();f.tableExport.update({formats:["xls","xlsx"],fileName:"Users"+(new Date().toJSON().slice(0,10).replace(/-/g,"_")),headings:true});$("#hiddenPrintedTitle").val("Users Report")};SettingsHandler.prototype.user_details=null;SettingsHandler.prototype.view_user=function(){var a=$(this).data("object");clearFormValidators($("#userCreationForm"));SettingsHandler.self.user_details=a;hideContent();SettingsHandler.prototype.disableUserFieldsForUpdate();SettingsHandler.prototype.showUpdateUserButtons();initDefaultContent("Edit User ");document.getElementById("userCreationForm").reset();var c=handlers.Roles.get_system_roles();var f="";f+="<option value=''>  Select User Role  </option>";if(c!=undefined&&c!=null){for(var b=0;b<c.length;b++){f+="<option  data-toggle='tooltip' data-trigger='focus' data-placement='top' title=' DESCRIPTION :  "+c[b].description+"'   value='"+c[b].id+"' id='"+c[b].id+"' data-description='"+c[b].description+"'> "+c[b].name+" </option>"}}$("#userRole").html(f);var h=handlers.Offices.get_system_offices();var d="";d+="<option value=''>  Select Office  </option>";if(h!=undefined&&h!=null){for(var e=0;e<h.length;e++){d+="<option  data-toggle='tooltip' data-trigger='focus' data-placement='top' title=' DESCRIPTION :  "+h[e].nameDecorated+"'   value='"+h[e].id+"' id='"+h[e].id+"' data-description='"+h[e].name+"'> "+h[e].name+" </option>"}}$("#userOffice").html(d);$("[data-toggle='tooltip']").tooltip({placement:$(this).data("placement")||"top"});$("#userCreationForm").off("submit");$("#userCreationForm").on("submit",SettingsHandler.self.addUser);$("#auto_generate_password").off("click");$("#auto_generate_password").on("click",SettingsHandler.prototype.auto_generate_password);$("#backtoUsersButton").off("click");$("#backtoUsersButton").on("click",SettingsHandler.self.manage_users);$("#createUserButtom").html('<i class="mdl-color-text--white material-icons" role="presentation">create</i>Update User').val("update");$(".create_staff_panel").fadeIn("fast");$("#userFirstName").attr("required","required");$(".userFirstName_panel").show();$("#userOffice").attr("required","required");$(".userOffice_panel").show();$("#userFirstName").attr("required","required");$(".userFirstName_panel").show();$("#userLastName").attr("required","required");$(".userLastName_panel").show();$("#userEmailAddress").attr("required","required");$(".userEmailAddress_panel").show();$("#userRole").attr("required","required");$(".userRole_panel").show();showContent($("#add_user_page"));$("#userFirstName").val(a.firstname);$("#userLastName").val(a.lastname);$("#userRole").val(a.selectedRoles[0].id);$("#userOffice").val(a.officeId);$("#userEmailAddress").val(a.email);$("#user_username").val(a.username);$("#user_username").removeAttr("required");$(".username_panel").hide();$("#user_password").removeAttr("required");$(".userpassword_panel").hide();$("#user_re_password").removeAttr("required");$(".user_re_password_panel").hide();$(".auto_generate_password_panel").hide();var g='Update User<a class="btn customCancelButton pull-right" id="_update_user_password_btn" data-target="profile">Update Password</a>';$("#add_user_page .panel-heading").html(g);$("#_update_user_password_btn").off();$("#_update_user_password_btn").on("click touch",SettingsHandler.self.init_password_update);$("#deactivateUsersButton").fadeIn("fast");$("#deactivateUsersButton").off();$("#deactivateUsersButton").val("deactivate");var i=' <i class="mdl-color-text--white material-icons" role="presentation">person</i> Deactivate User ';$("#deactivateUsersButton").html(i);$("#deactivateUsersButton").off().on("click touch",SettingsHandler.self.deactivateUser);$("#editUserButton").off("click touch").on("click touch",function(){$("#userCreationForm").off("submit");$("#userCreationForm").on("submit",function(j){j.preventDefault()});SettingsHandler.prototype.handleEditUserButton()});$("#updateUserButton").off("click touch").on("click touch",function(){$("#userCreationForm").off("submit");$("#userCreationForm").on("submit",function(j){j.preventDefault()});SettingsHandler.prototype.handleUpdateUserDetailsButton()});$("#cancelEditButton").off("click touch").on("click touch",function(){$("#userCreationForm").off("submit");$("#userCreationForm").on("submit",function(j){j.preventDefault()});SettingsHandler.prototype.handleCancelEditUserButton()})};SettingsHandler.prototype.deactivateUser=function(){var b="Confirm User Deactivate";var d="Are you sure you want to deactivate this user ?";var c="Yes";var a="No";showDialogPopupWithHandlers(b,d,c,function(){var e=SettingsHandler.self.user_details.id;var f=host+"/user/v1d/deactiveUser/"+e;var g=getAuthenticationHeader();$.ajax({url:f,dataType:"json",contentType:"application/json; charset=utf-8",headers:g,type:"POST",beforeSend:function(){showLoader()},success:function(i){var h=' <i class="mdl-color-text--white material-icons" role="presentation">person</i> Deactivate User ';$("#deactivateUsersButton").html(h);$("#deactivateUsersButton").off();SettingsHandler.prototype.deactivateLocalUser(e);SettingsHandler.self.manage_users();hideLoader();showAlertMessage("User Deactivated Succesfully",AlertTypes.success)},complete:function(){}}).fail(function(h){})},a,function(){})};SettingsHandler.prototype.deactivateLocalUser=function(a){var c=SettingsHandler.self.system_users_list;for(var b=0;b<c.length;b++){if(c[b].id===a){SettingsHandler.self.system_users_list.splice(b,1);break}}};SettingsHandler.prototype.showUpdatePasswordButtons=function(){$("#cancelPasswordEditButton").show();$("#updateUserPasswordButton").show();$("#createUserButtom").hide();$("#backtoUsersButton").hide();$("#deactivateUsersButton").hide();$("#editUserButton").hide();$("#updateUserButton").hide();$("#cancelEditButton").hide()};SettingsHandler.prototype.hideUpdatePasswordButtons=function(){$("#cancelPasswordEditButton").hide();$("#updateUserPasswordButton").hide();$("#createUserButtom").hide();$("#backtoUsersButton").show();$("#deactivateUsersButton").show();$("#editUserButton").show();$("#updateUserButton").hide();$("#cancelEditButton").hide()};SettingsHandler.prototype.handleCancelPasswordUpdateButton=function(){SettingsHandler.prototype.hideUpdatePasswordButtons();clearFormValidators($("#userCreationForm"));var a=SettingsHandler.self.user_details;hideContent();SettingsHandler.prototype.disableUserFieldsForUpdate();SettingsHandler.prototype.showUpdateUserButtons();initDefaultContent("Edit User ");document.getElementById("userCreationForm").reset();var c=handlers.Roles.get_system_roles();var f="";f+="<option value=''>  Select User Role  </option>";if(c!=undefined&&c!=null){for(var b=0;b<c.length;b++){f+="<option  data-toggle='tooltip' data-trigger='focus' data-placement='top' title=' DESCRIPTION :  "+c[b].description+"'   value='"+c[b].id+"' id='"+c[b].id+"' data-description='"+c[b].description+"'> "+c[b].name+" </option>"}}$("#userRole").html(f);var h=handlers.Offices.get_system_offices();var d="";d+="<option value=''>  Select Office  </option>";if(h!=undefined&&h!=null){for(var e=0;e<h.length;e++){d+="<option  data-toggle='tooltip' data-trigger='focus' data-placement='top' title=' DESCRIPTION :  "+h[e].nameDecorated+"'   value='"+h[e].id+"' id='"+h[e].id+"' data-description='"+h[e].name+"'> "+h[e].name+" </option>"}}$("#userOffice").html(d);$("[data-toggle='tooltip']").tooltip({placement:$(this).data("placement")||"top"});$("#userCreationForm").off("submit");$("#userCreationForm").on("submit",SettingsHandler.self.addUser);$("#auto_generate_password").off("click");$("#auto_generate_password").on("click",SettingsHandler.prototype.auto_generate_password);$("#backtoUsersButton").off("click");$("#backtoUsersButton").on("click",SettingsHandler.self.manage_users);$("#createUserButtom").html('<i class="mdl-color-text--white material-icons" role="presentation">create</i>Update User').val("update");$(".create_staff_panel").fadeIn("fast");$("#userFirstName").attr("required","required");$(".userFirstName_panel").show();$("#userOffice").attr("required","required");$(".userOffice_panel").show();$("#userFirstName").attr("required","required");$(".userFirstName_panel").show();$("#userLastName").attr("required","required");$(".userLastName_panel").show();$("#userEmailAddress").attr("required","required");$(".userEmailAddress_panel").show();$("#userRole").attr("required","required");$(".userRole_panel").show();showContent($("#add_user_page"));$("#userFirstName").val(a.firstname);$("#userLastName").val(a.lastname);$("#userRole").val(a.selectedRoles[0].id);$("#userOffice").val(a.officeId);$("#userEmailAddress").val(a.email);$("#user_username").val(a.username);$("#user_username").removeAttr("required");$(".username_panel").hide();$("#user_password").removeAttr("required");$(".userpassword_panel").hide();$("#user_re_password").removeAttr("required");$(".user_re_password_panel").hide();$(".auto_generate_password_panel").hide();var g='Update User<a class="btn customCancelButton pull-right" id="_update_user_password_btn" data-target="profile">Update Password</a>';$("#add_user_page .panel-heading").html(g);$("#_update_user_password_btn").off();$("#_update_user_password_btn").on("click touch",SettingsHandler.self.init_password_update);$("#deactivateUsersButton").fadeIn("fast");$("#deactivateUsersButton").off();$("#deactivateUsersButton").val("deactivate");var i=' <i class="mdl-color-text--white material-icons" role="presentation">person</i> Deactivate User ';$("#deactivateUsersButton").html(i);$("#deactivateUsersButton").off().on("click touch",SettingsHandler.self.deactivateUser);$("#editUserButton").off("click touch").on("click touch",function(){$("#userCreationForm").off("submit");$("#userCreationForm").on("submit",function(j){j.preventDefault()});SettingsHandler.prototype.handleEditUserButton()});$("#updateUserButton").off("click touch").on("click touch",function(){$("#userCreationForm").off("submit");$("#userCreationForm").on("submit",function(j){j.preventDefault()});SettingsHandler.prototype.handleUpdateUserDetailsButton()});$("#cancelEditButton").off("click touch").on("click touch",function(){$("#userCreationForm").off("submit");$("#userCreationForm").on("submit",function(j){j.preventDefault()});SettingsHandler.prototype.handleCancelEditUserButton()})};SettingsHandler.prototype.handleSubmitPasswordButton=function(g){if($("#user_username").val().length>4&&$("#user_re_password").val().length>7&&$("#user_password").val().length>7){console.log("reached here 1");var f=$("#user_username").val();var h=$("#user_re_password").val();var a=$("#user_password").val();if(h===a){console.log("reached here 2");var c="Confirm Password Update";var i="Are you sure you want to edit this user's credentials with the provided details";var d="Yes";var b="No";showDialogPopupWithHandlers(c,i,d,function(){var k=SettingsHandler.self.user_details;var j=host+"/user/v1d/updatePassword/"+k.id;var e='{"password":"'+a+'","repeatPassword":"'+a+'","username":"'+f+'"}';$.ajax({url:j,data:e,dataType:"json",contentType:"application/json; charset=utf-8",headers:getAuthenticationHeader(),type:"POST",beforeSend:function(){showLoader()},success:function(l){console.log("Successful user password update");SettingsHandler.prototype.updateLocalUserUserName(k.id,f);SettingsHandler.self.user_details=null;$("#createUserButtom").html(' <i class="mdl-color-text--white material-icons" role="presentation">create</i> Submit').val("save");document.getElementById("userCreationForm").reset();hideLoader();showAlertMessage("User credentials successfully updated",AlertTypes.success);SettingsHandler.self.manage_users()},complete:function(){hideLoader()}}).fail(function(l){hideLoader();if(l.status===403){showAlertMessage("User with Username or Email Already Exists in the databse ",AlertTypes.warning)}else{if(l.status===500){showAlertMessage("Server Not Reacheable, Check Your Internet Connectivity ",AlertTypes.danger)}else{showAlertMessage("Something went wrong contact customer support ",AlertTypes.danger)}}})},b,function(){})}else{console.log("reached here 3");showAlertMessage("Please ensure that both passwords match.",AlertTypes.danger)}}else{console.log("reached here 4");showAlertMessage("Please ensure that all fields are filled in correctly",AlertTypes.danger)}};SettingsHandler.prototype.init_password_update=function(){showContent($("#add_user_page"));SettingsHandler.prototype.showUpdatePasswordButtons();$("#updateUserPasswordButton").on("click touch",function(){$("#userCreationForm").off("submit");$("#userCreationForm").on("submit",function(a){a.preventDefault()});SettingsHandler.prototype.handleSubmitPasswordButton()});$("#cancelPasswordEditButton").on("click touch",function(){$("#userCreationForm").off("submit");$("#userCreationForm").on("submit",function(a){a.preventDefault()});SettingsHandler.prototype.handleCancelPasswordUpdateButton()});$(".create_staff_panel").hide();$("#userFirstName").removeAttr("required");$(".userFirstName_panel").hide();$("#userOffice").removeAttr("required");$(".userOffice_panel").hide();$("#userFirstName").removeAttr("required");$(".userFirstName_panel").hide();$("#userLastName").removeAttr("required");$(".userLastName_panel").hide();$("#userEmailAddress").removeAttr("required");$(".userEmailAddress_panel").hide();$("#userRole").removeAttr("required");$(".userRole_panel").hide();$("#user_username").attr("required","required");$(".username_panel").show();$(".userpassword_panel").show();$("#user_password").attr("required","required").show();$(".user_re_password_panel").show();$("#user_re_password").attr("required","required").show();$(".auto_generate_password_panel").show()};SettingsHandler.prototype.showCreateUserButtons=function(){$("#createUserButtom").show();$("#backtoUsersButton").show();$("#deactivateUsersButton").hide();$("#editUserButton").hide();$("#updateUserButton").hide();$("#cancelEditButton").hide();$("#cancelPasswordEditButton").hide();$("#updateUserButton").hide();$("#cancelPasswordEditButton").hide();$("#updateUserPasswordButton").hide()};SettingsHandler.prototype.showUpdateUserButtons=function(){$("#createUserButtom").hide();$("#backtoUsersButton").show();$("#deactivateUsersButton").show();$("#editUserButton").show();$("#updateUserButton").hide();$("#cancelEditButton").hide();$("#updateUserButton").hide();$("#cancelPasswordEditButton").hide();$("#updateUserPasswordButton").hide()};SettingsHandler.prototype.disableUserFieldsForUpdate=function(){document.getElementById("userFirstName").disabled=true;document.getElementById("userOffice").disabled=true;document.getElementById("userLastName").disabled=true;document.getElementById("userRole").disabled=true;document.getElementById("userEmailAddress").disabled=true};SettingsHandler.prototype.enableUserFieldsForUpdate=function(){document.getElementById("userFirstName").disabled=false;document.getElementById("userOffice").disabled=false;document.getElementById("userLastName").disabled=false;document.getElementById("userRole").disabled=false;document.getElementById("userEmailAddress").disabled=false};SettingsHandler.prototype.handleEditUserButton=function(){SettingsHandler.prototype.enableUserFieldsForUpdate();$("#cancelEditButton").show();$("#updateUserButton").show();$("#editUserButton").hide();$("#createUserButtom").hide();$("#backtoUsersButton").hide();$("#deactivateUsersButton").hide()};SettingsHandler.prototype.handleCancelEditUserButton=function(){SettingsHandler.prototype.disableUserFieldsForUpdate();SettingsHandler.prototype.showUpdateUserButtons();$("#userFirstName").val(SettingsHandler.self.user_details.firstname);$("#userLastName").val(SettingsHandler.self.user_details.lastname);$("#userRole").val(SettingsHandler.self.user_details.selectedRoles[0].id);$("#userOffice").val(SettingsHandler.self.user_details.officeId);$("#userEmailAddress").val(SettingsHandler.self.user_details.email);$("#user_username").val(SettingsHandler.self.user_details.username)};SettingsHandler.prototype.handleUpdateUserDetailsButton=function(){if(validateForm($("#userCreationForm"))){var k=$("#userFirstName").val();var l=$("#userLastName").val();var b=$("#userRole").val();var g=$("#userRole option:selected").text();var d=$("#userOffice").val();var f=$("#userOffice option:selected").text();var e=$("#userEmailAddress").val();var h=$("#user_username").val();userEditBodyDetails=[];userEditBodyDetails.firstname=k;userEditBodyDetails.lastname=l;userEditBodyDetails.roleid=b;userEditBodyDetails.rolename=g;userEditBodyDetails.officeid=d;userEditBodyDetails.officename=f;userEditBodyDetails.email=e;userEditBodyDetails.username=h;userEditBodyDetails.userid=SettingsHandler.self.user_details.id;var m=SettingsHandler.self.user_details;var a="Confirm User Update";var i="Are you sure you want to edit this user with the provided details";var j="Yes";var c="No";showDialogPopupWithHandlers(a,i,j,SettingsHandler.prototype.sendUserUpdateDataHandler,c,SettingsHandler.prototype.handleNoConfirmUserOption)}else{showAlertMessage("Please ensure that all fields are filled in correctly",AlertTypes.danger)}};SettingsHandler.prototype.handleNoConfirmUserOption=function(){};SettingsHandler.prototype.sendUserUpdateDataHandler=function(){var b=host+"/user/v1d/editUser/"+userEditBodyDetails.userid;var a='{"firstname":"'+userEditBodyDetails.firstname+'"\n                ,"lastname":"'+userEditBodyDetails.lastname+'"\n                ,"email":"'+userEditBodyDetails.email+'"\n                ,"officeId":"'+userEditBodyDetails.officeid+'"\n                ,"roleId":"'+userEditBodyDetails.roleid+'"}';$.ajax({url:b,data:a,dataType:"json",contentType:"application/json; charset=utf-8",headers:getAuthenticationHeader(),type:"POST",beforeSend:function(){showLoader()},success:function(c){console.log("successful user edit");console.log(c);SettingsHandler.prototype.handleSuccessfulUserEdit()},complete:function(){}}).fail(function(c){SettingsHandler.prototype.handleFailedUserEdit()})};SettingsHandler.prototype.handleSuccessfulUserEdit=function(){var a=userEditBodyDetails.userid,i=userEditBodyDetails.firstname,k=userEditBodyDetails.lastname,e=userEditBodyDetails.username,h=userEditBodyDetails.email,j=userEditBodyDetails.officeid,c=userEditBodyDetails.officename,b=userEditBodyDetails.roleid,d=userEditBodyDetails.rolename,g="",f="";SettingsHandler.prototype.updateLocalUser(a,i,k,e,h,j,c,b,d,g,f);document.getElementById("userCreationForm").reset();hideLoader();showAlertMessage("User details successfully updated",AlertTypes.success);SettingsHandler.self.user_details=null;SettingsHandler.self.manage_users()};SettingsHandler.prototype.handleFailedUserEdit=function(){hideLoader();showAlertMessage("Failed to update user details, Please try again",AlertTypes.info)};SettingsHandler.prototype.add_user=function(){hideContent();initDefaultContent("Create User");SettingsHandler.prototype.enableUserFieldsForUpdate();SettingsHandler.prototype.showCreateUserButtons();document.getElementById("userCreationForm").reset();clearFormValidators($("#userCreationForm"));registerKeyPressValidators($("#userCreationForm"));var d=handlers.Roles.get_system_roles();var b="";b+="<option value=''>  Select User Role  </option>";if(undefined!=d||null!=d){for(var f=0;f<d.length;f++){b+="<option  data-toggle='tooltip' data-trigger='focus' data-placement='top' title=' DESCRIPTION :  "+d[f].description+"'   value='"+d[f].id+"' id='"+d[f].id+"' data-description='"+d[f].description+"'> "+d[f].name+" </option>"}}$("#userRole").html(b);var a=handlers.Offices.get_system_offices();var e="";e+="<option   value=''  >  Select Office  </option>";if(undefined!=a||null!=a){for(var c=0;c<a.length;c++){e+="<option  data-toggle='tooltip' data-trigger='focus' data-placement='top' title=' DESCRIPTION :  "+a[c].nameDecorated+"'   value='"+a[c].id+"' id='"+a[c].id+"' data-description='"+a[c].name+"'> "+a[c].name+" </option>"}}$("#userOffice").html(e);$("[data-toggle='tooltip']").tooltip({placement:$(this).data("placement")||"top"});$("#userCreationForm").off("submit");$("#userCreationForm").on("submit",SettingsHandler.self.addUser);$("#auto_generate_password").off("click");$("#auto_generate_password").on("click",SettingsHandler.prototype.auto_generate_password);$("#backtoUsersButton").off("click");$("#backtoUsersButton").on("click",SettingsHandler.self.manage_users);showContent($("#add_user_page"));$("#add_user_page .panel-heading").text("Add User");$("#createUserButtom").html('<i class="mdl-color-text--white material-icons" role="presentation">create</i> Submit').val("save");$("#user_username").attr("required","required");$(".username_panel").show();$("#user_password").attr("required","required");$(".userpassword_panel").show();$("#user_re_password").attr("required","required");$(".user_re_password_panel").show();$(".auto_generate_password_panel").show();$(".create_staff_panel").show();$("#userFirstName").attr("required","required");$(".userFirstName_panel").show();$("#userOffice").attr("required","required");$(".userOffice_panel").show();$("#userFirstName").attr("required","required");$(".userFirstName_panel").show();$("#userLastName").attr("required","required");$(".userLastName_panel").show();$("#userEmailAddress").attr("required","required");$(".userEmailAddress_panel").show();$("#userRole").attr("required","required");$(".userRole_panel").show();$("#userpassword").attr("required","required").fadeIn("fast");$(".userpassword_panel").show();$("#user_re_password").attr("required","required").fadeIn("fast");$(".user_re_password_panel").show();$("#deactivateUsersButton").hide()};SettingsHandler.prototype.auto_generate_password=function(a){if($(this)[0].checked){$("#user_password").removeAttr("required").fadeOut("slow");$("#user_re_password").removeAttr("required").fadeOut("slow");$("#userEmailAddress").attr("required","required");$(".userpassword_panel").fadeOut("slow");$(".user_re_password_panel").fadeOut("fast")}else{$("#user_password").attr("required","required").fadeIn("slow");$("#user_re_password").attr("required","required").fadeIn("slow");$("#userEmailAddress").removeAttr("required");$(".userpassword_panel").fadeIn("slow");$(".user_re_password_panel").fadeIn("fast")}};SettingsHandler.prototype.addUser=function(u){u.preventDefault();if(validateForm($("#userCreationForm"))){var l=$(this);var a=$("input[type=submit]",l);var w=true;var v=$("#auto_generate_password").is(":checked");var f=$("#userFirstName").val();var k=$("#userLastName").val();var n=$("#userRole").val();var r=$("#userRole option:selected").text();var b=$("#userOffice").val();var g=$("#userOffice option:selected").text();var h=$("#userEmailAddress").val();var z=$("#user_username").val();var y="";var e="";var s=$("#createUserButtom").val();var p=null;if(s==="save"){p=["firstname","lastname","role","office","username"]}if(s==="update_password"){p=["username"]}var m=0;if(p!==null){while(m<p.length){switch(p[m]){case"username":if(z.length===0||z===""||z===undefined){showAlertMessage("Enter First Name",AlertTypes.warning);return}break;case"firstname":if(f.length===0||f===""||f===undefined){showAlertMessage("Enter First Name",AlertTypes.warning);return}break;case"lastname":if(f.length===0||f===""||f===undefined){showAlertMessage("Enter First Name",AlertTypes.warning);return}break;case"role":if(n.length===0||n===""||n===undefined){showAlertMessage("Select Role",AlertTypes.warning);return}break;case"office":if(b.length===0||b===""||b===undefined){showAlertMessage("Select Office ",AlertTypes.warning);return}break;default:break}m++}}if(v===true){y=e=generatePassword()}else{y=$("#user_password").val();e=$("#user_re_password").val();if(y!==e){showAlertMessage("Passwords Do not Match ",AlertTypes.warning);return}}var o="";var c=getAuthenticationHeader();var d="";if(s==="save"){d=host+"/user/v1d/createUser";o='{"firstname":"'+f+'","lastname":"'+k+'","password":"'+y+'","repeatPassword":"'+y+'","email":"'+h+'","officeId":"'+b+'","roleId":"'+n+'","username":"'+z+'","creat_staff":"'+(w?true:false)+'"}';var i="Confirm User Details";var j="Are you sure you want to create this user with the provided details";var q="Yes";var t="No";showDialogPopupWithHandlers(i,j,q,function(){$.ajax({url:d,data:o,dataType:"json",contentType:"application/json; charset=utf-8",headers:c,type:"POST",beforeSend:function(){showLoader();a.prop("disabled","disabled")},success:function(x){console.log("Successful user creation");console.log(x);SettingsHandler.prototype.populateNewLocalUser(x.resourceId,f,k,z,h,b,g,n,r,x.awamoId,x.staffId);SettingsHandler.self.user_details=null;$("#createUserButtom").html(' <i class="mdl-color-text--white material-icons" role="presentation">create</i> Submit').val("save");document.getElementById("userCreationForm").reset();hideLoader();showAlertMessage("Record Saved Successfully",AlertTypes.success);SettingsHandler.self.manage_users()},complete:function(){hideLoader();a.prop("disabled",false)}}).fail(function(x){hideLoader();if(x.status===403){showAlertMessage("User with Username or Email Already Exists in the databse ",AlertTypes.warning)}else{if(x.status===500){showAlertMessage("Server Not Reacheable, Check Your Internet Connectivity ",AlertTypes.danger)}else{showAlertMessage("Something went Wrong contact Administrator ",AlertTypes.danger)}}})},t,function(){})}}else{showAlertMessage("Please ensure that all fields are filled in correctly",AlertTypes.danger)}};SettingsHandler.prototype.handleCreateUserEvent=function(b,a,d,c){$.ajax({url:b,data:a,dataType:"json",contentType:"application/json; charset=utf-8",headers:d,type:"POST",beforeSend:function(){showLoader();c.prop("disabled","disabled")},success:function(e){console.log("Successful user creation");console.log(e);SettingsHandler.prototype.populateNewLocalUser(e.resourceId,userFirstName,userLastName,user_username,userEmailAddress,userOffice,officeName,userRole,roleName,e.awamoId,e.staffId);SettingsHandler.self.user_details=null;$("#createUserButtom").html(' <i class="mdl-color-text--white material-icons" role="presentation">create</i> Submit').val("save");document.getElementById("userCreationForm").reset();hideLoader();showAlertMessage("Record Saved Successfully",AlertTypes.success);SettingsHandler.self.manage_users()},complete:function(){hideLoader();c.prop("disabled",false)}}).fail(function(e){hideLoader();if(e.status===403){showAlertMessage("User with Username or Email Already Exists in the databse ",AlertTypes.warning)}else{if(e.status===500){showAlertMessage("Server Not Reacheable, Check Your Internet Connectivity ",AlertTypes.danger)}else{showAlertMessage("Something went Wrong contact Administrator ",AlertTypes.danger)}}})};SettingsHandler.prototype.populateNewLocalUser=function(b,l,n,g,j,m,e,d,f,i,h){var a=[];var c=[];var k=[];k.id=d;k.name=f;a.id=b;a.firstname=l;a.lastname=n;a.selectedRoles=c;a.selectedRoles[0]=k;a.officeId=m;a.officeName=e;a.email=j;a.username=g;a.awamoId=i;a.staffId=h;SettingsHandler.self.system_users_list.push(a)};SettingsHandler.prototype.updateLocalUser=function(a,k,m,f,i,l,d,c,e,h,g){var n=[];var b=[];var j=[];j.id=c;j.name=e;n.id=a;n.firstname=k;n.lastname=m;n.selectedRoles=b;n.selectedRoles[0]=j;n.officeId=l;n.officeName=d;n.email=i;n.username=f;n.awamoId=h;n.staffId=g;$.each(SettingsHandler.self.system_users_list,function(o,p){if(p.id===a){SettingsHandler.self.system_users_list[o]=n}})};SettingsHandler.prototype.updateLocalUserUserName=function(b,a){$.each(SettingsHandler.self.system_users_list,function(c,d){if(d.id===b){SettingsHandler.self.system_users_list[c].username=a}})};SettingsHandler.prototype.manage_roles=function(){clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();currentTable="SystemRoles";handlers.Roles.display_roles()};SettingsHandler.prototype.add_role=function(){clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();currentTable="SystemRoles";handlers.Roles.add_role()};