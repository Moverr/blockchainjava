
var DashboardHandler=function(){DashboardHandler.self=this;DashboardHandler.self.registerHandlers();loanList.addEntityChangedEventListenerCallback(DashboardHandler.prototype._entityChanged)};DashboardHandler.prototype.registerHandlers=function(){$("#dashboardArea button[data-target]").on("click touch",DashboardHandler.prototype.buttonHandler)};DashboardHandler.prototype.buttonHandler=function(a){a.preventDefault();$("#"+$(this).data("target")+" a").click()};DashboardHandler.prototype.init=function(){handlers.Permissions.init();$(".sidebar").show();var a=$(window).height()-70;$(".sidebar").fadeIn();$(".main").show();handlers.Menu.display_menu();$("#singleActions a[data-action]").on("click touch",function(){$("#messagebox").stop().slideUp(500)});handlers.Communication.initData();statusbar("loading data");DashboardHandler.self.overview();showLoader("Loading data, Please wait...")};DashboardHandler.prototype.overview=function(){addHistory("Dashboard overview","#dashboardOverview","#dashboard");initDefaultContent("Dashboard");clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();if(handlers.Permissions.check_access("_OVERVIEW")){DashboardHandler.self.showOverview();showContent($("#dashboardArea"))}};DashboardHandler.prototype.addLoan=function(f){var g=null;if(f.status==="SUBMITTED"){var i=$("#dashboardLoanApplications table tbody");i.find('[data-id="'+f.loanId+'"]').remove();var c=handlers.Loan;var h=(typeof(c)!=="undefined"&&c!==null);var b={img:'<img src="images/personPlaceholderNoText.png" alt="" height="28" />',name:f.clientName,date:formatDate(f.disbursementDate),principal:formatCurrency(f.principal)+" "+currencyCode,interest:formatPercentageShort(f.interestRate)+"%",duration:f.duration+"d"};g=addRow(i,b,h?f:null,h?c.rowClickHandler:null,f.loanId);addClassToColumnOfTableRow(g,1,"image");if(exists(f)&&exists(f.client)){var d=f.client;var e=$("img",g);if(exists(d.image)){var a="data:image/jpeg;base64,"+d.image;e.attr("src",a);e.attr("height","30px");e.attr("width","30px");g.css("line-height",0)}}}return g};DashboardHandler.prototype.showOverview=function(){var a=$("#dashboardOverview");DashboardHandler.self.loadOverviewReport("Clients");DashboardHandler.self.loadOverviewReport("LoanApplications");DashboardHandler.self.loadOverviewReport("SavingsAccounts");DashboardHandler.self.loadOverviewReport("ActiveSavingsAccounts");DashboardHandler.self.ClientActivityReport();DashboardHandler.self.OverviewReportSummary("outstanding_balance");DashboardHandler.self.OverviewReportSummary("new_loan_applications");DashboardHandler.self.OverviewReportSummary("total_active_loans");DashboardHandler.self.OverviewReportSummary("total_savings_derived");DashboardHandler.self.OverviewReportSummary("total_new_savings_accounts");showContent(a)};DashboardHandler.prototype.OverviewReportSummary=function(a){switch(a){case"outstanding_balance":ajax("/report/v1d/activeLoansReport","GET",function(b){$("#dashboardOverviewReportTotalOutstandingLoansBalance .prefix").html("Total Outstanding ("+currencyCode+")");$("#dashboardOverviewReportTotalOutstandingLoansBalance").find("td:last-child").html(numberWithCommas(b.count))});break;case"new_loan_applications":ajax("/report/v1d/newLoanApplicationsSummary","GET",function(b){$("#dashboardOverviewReportTotalNewLoanApplications").find("td:last-child").html(numberWithCommas(b.count))});break;case"total_active_loans":ajax("/report/v1d/summaryActiveLoans","GET",function(b){$("#dashboardOverviewReportTotalActiveLoans").find("td:last-child").html(numberWithCommas(b.count))});break;case"total_savings_derived":ajax("/report/v1d/totalSavings","GET",function(b){$("#dashboardOverviewReportTotalSavingsAmount .prefix").html("Total Savings ("+currencyCode+")");$("#dashboardOverviewReportTotalSavingsAmount").find("td:last-child").html(numberWithCommas(b.count))});break;case"total_savings_accounts":ajax("/report/v1d/totalSavingsAccounts","GET",function(b){$("#dashboardOverviewReportActiveSavingsAccounts").find("td:last-child").html(numberWithCommas(b.count))});break;case"total_new_savings_accounts":ajax("/report/v1d/totalNewSavingsAccounts","GET",function(b){$("#dashboardOverviewReportTotalNewSavingsAccounts").find("td:last-child").html(numberWithCommas(b.count))});break;default:break}};DashboardHandler.prototype.ClientActivityReport=function(){ajax("/tenant/v1d/mis/clientActivityReport","GET",function(a){$("#dashboardOverviewReportActiveClients").find("td:last-child").html(a.active);$("#dashboardOverviewReportPassiveClients").find("td:last-child").html(a.passive);$("#dashboardOverviewReporttotalClients").find("td:last-child").html(a.total)})};DashboardHandler.prototype.showLoanApplications=function(){currentTable="dashboardLoanApplications";var b=$("#dashboardLoanApplications table");var a=b.find("tbody");a.empty();loanList.getSubmittedLoanList().forEach(function(c){DashboardHandler.self.addLoan(c)});addClassToTableColumn(b,0,"image");showContent($("#dashboardArea"))};DashboardHandler.prototype.showProfile=function(){var a=$("#dashboardProfile");a.find("input[data-target]").each(function(){$(this).val(getTargetFromObject($(this),user))});showContent(a)};DashboardHandler.prototype._entityChanged=function(a){if("dashboardLoanApplications"===currentTable){DashboardHandler.self.addLoan(a)}};DashboardHandler.prototype.loadOverviewReport=function(a){ajax("/report/v1d/new"+a+"Report","GET",function(c){var d=a.split(/(?=[A-Z])/).join(" ").toLowerCase();var b=$("#dashboardOverviewReportNew"+a);b.empty();b.append($('<td class="prefix">New '+d+"</td>"));b.append($("<td>"+c.day+"</td>"));b.append($("<td>"+c.week+"</td>"));b.append($("<td>"+c.month+"</td>"));b.append($("<td>"+c.year+"</td>"));b.on("click touch",DashboardHandler.prototype.overviewReportRowClickHandler)})};DashboardHandler.prototype.overviewReportRowClickHandler=function(){var d=$(this).attr("id").substr(26);var b=d.endsWith("Applications")?"Applications":"All";var a=d.replace("Application","").slice(0,-1);var c=$('li.subitem[data-handler="'+a+'"][data-action="get'+b+'"] a');c.click()};