var manageOfficeCreationDate;var OfficeHandler=function(){OfficeHandler.self=this};OfficeHandler.prototype.system_offices=null;OfficeHandler.prototype.init=function(a){ajax("/offices/v1d/getAllOffices/","GET",function(b){OfficeHandler.self.system_offices=b;if(undefined!==a&&null!==a){a()}},null,getAuthenticationHeader())};OfficeHandler.prototype.get_system_offices=function(){return OfficeHandler.self.system_offices};OfficeHandler.DISPLAY_OFFICE_TITLES={fullname:"Name",parentOffice:"Parent Office ",date_created:" Date Opened "};OfficeHandler.prototype.add_office=function(){hideContent();$("#officeFormPanelHeading").html("New Office");OfficeHandler.prototype.enableOfficeFieldsForCreateAndEdit();OfficeHandler.prototype.showOfficeCreationButtons();var a=OfficeHandler.self.get_system_offices();var c="";c+="<option   value=''  >  Select Office  </option>";if(a!=undefined&&a!=null){for(var b=0;b<a.length;b++){c+="<option  data-toggle='tooltip' data-trigger='focus' data-placement='top' title=' DESCRIPTION :  "+a[b].nameDecorated+"'   value='"+a[b].id+"' id='"+a[b].id+"' data-description='"+a[b].name+"'> "+a[b].name+" </option>"}}$("#systemOffices").html(c);$("#createOfficeButtom").off("click touch").on("click touch",OfficeHandler.self.handleOfficeCreateButton);$("#back_to_offices").off("click").on("click",handlers.Settings.manage_offices);document.getElementById("createOffficeForm").reset();clearFormValidators($("#createOffficeForm"));registerKeyPressValidators($("#createOffficeForm"));showContent($("#add_office_page"));$("#office_date_opened").prop("disabled",false)};OfficeHandler.prototype.handleOfficeCreateButton=function(b){b.preventDefault();if(validateForm($("#createOffficeForm"))){var j=$(this);var e=$("input[type=submit]",j);var f=$("#officeName").val();var a=$("#systemOffices").val();var h=manageOfficeCreationDate;if(h===null||h===""||h==="undefined"){showAlertMessage("Enter Date Created ",AlertTypes.warning);return}if(f===null||f===""||f===undefined||f.length===0){showAlertMessage("Enter Office Name",AlertTypes.warning);return}var c="Confirm Office Creation";var g="Are you sure you want to create this office with the provided details";var i="Yes";var d="No";showDialogPopupWithHandlers(c,g,i,function(){var m=new Date(manageOfficeCreationDate);var l=m.toString("dd MMM yyyy");var k='{"name":"'+f+'"';if(a>0){k+=',"parentId":"'+a+'"'}k+=',"openingDate":"'+l+'"}';var o=getAuthenticationHeader();var n=$("body");$.ajax({url:host+"/offices/v1d/createOffice",data:k,dataType:"json",contentType:"application/json; charset=utf-8",headers:o,type:"POST",beforeSend:function(){showLoader();e.prop("disabled","disabled")},success:function(p){OfficeHandler.self.init(function(){showAlertMessage("Office Saved Successfully",AlertTypes.success);hideLoader();handlers.Settings.manage_offices()})},complete:function(){hideLoader();e.prop("disabled",false)}}).fail(function(p){if(p.status===403){showAlertMessage("Office was not Saved Correctlty",AlertTypes.danger)}else{if(p.status===404){showAlertMessage("Server Not Reacheable, Check Your Internet Connectivity ",AlertTypes.danger)}else{showAlertMessage("Something went Wrong contact Administrator ",AlertTypes.danger)}}hideLoader()})},d,function(){})}else{showAlertMessage("Please ensure that all the fields are filled in correctly",AlertTypes.danger)}};OfficeHandler.prototype.get_officeParent_id=function(c,f){var d=OfficeHandler.self.get_system_offices();var a=c.split(".");var b=[];if(a.length>1){b[0]=1}var e=1;$.each(a,function(g,h){if(a[g]!=f&&a[g]!=""){b[e]=parseInt(a[g]);e=e+1}});return b};OfficeHandler.prototype.get_officeParent=function(b,e){var c=OfficeHandler.self.get_system_offices();var a=b.split(".");var d=" ";if(a.length>1){d+=" Head Office , "}$.each(a,function(f,j){if(j!==""){var g=0;var h=0;while(g<c.length-1){if((""+c[g].id===j)&&(""+j!==""+e)){d+=c[g].name;if((h-g)>0){d+=" , "}h=g}g++}}});return d};OfficeHandler.prototype.display_offices=function(){OfficeHandler.self.currentOffice=null;initDefaultContent("Offices ");$("#printNow").off("click touch");$("#printNow").on("click touch",printData);$("#printNow").show();$("#create_object").off("click touch");$("#create_object").text("Create Office ");$("#create_object").on("click touch",OfficeHandler.self.add_office);$("#create_object").show();var f=OfficeHandler.self.get_system_offices();var k=getDefaultRowContainer(OfficeHandler.DISPLAY_OFFICE_TITLES,true);var j=k.parent();for(var d=0;d<f.length;d++){var l={};var c=f[d];l.name=c.name;var g=OfficeHandler.self.get_officeParent(f[d].hierarchy,f[d].id);l.parent_offices=g;var b=f[d].openingDate;if(b!==null||b!==undefined){l.date_created=" "+getMonth(b[1])+"  "+b[2]+" "+b[0]}else{l.date_created=" N/A"}addRow(k,l,f[d],OfficeHandler.self.rowClickHandler,f[d].id)}var e=getDefaultTableSorter();e.headers={3:{sorter:"awamoDateSorter"},4:{sorter:"awamoDateSorter"}};initialize_datatable(j);var a=document.getElementById("defaultTableContainer").getElementsByTagName("table");for(var d=0;d<a.length;d++){a[d].style.textAlign="right"}$("#tableTotal").text(f.length);showContent($("#tableTotalSum"));showContent($("#emailLoanReportDiv"));var h=$("#defaultTableContainer").tableExport();h.tableExport.update({formats:["xls","xlsx"],fileName:"Offices"+(new Date().toJSON().slice(0,10).replace(/-/g,"_")),headings:true});$("#hiddenPrintedTitle").val("Users Report")};OfficeHandler.prototype.rowClickHandler=function(){OfficeHandler.self.manage_office($(this).data("object"))};OfficeHandler.prototype.selected_office_id=0;OfficeHandler.prototype.manage_office=function(c){OfficeHandler.self.selected_office_id=c.id;OfficeHandler.prototype.disableOfficeFieldsForEdit();$("#cancelOfficeEditButton").off("click touch").on("click touch",function(h){h.preventDefault();OfficeHandler.prototype.handleOfficeCancelUpdateButton()});$("#editOfficeButtom").off("click touch").on("click touch",function(h){h.preventDefault();OfficeHandler.prototype.handleOfficeEditButton()});document.getElementById("createOffficeForm").reset();clearFormValidators($("#createOffficeForm"));registerKeyPressValidators($("#createOffficeForm"));$("#officeFormPanelHeading").html("View/Edit "+c.name);hideContent();var d=OfficeHandler.self.get_system_offices();var g="";g+="<option   value=''  >  Select Office  </option>";var b=OfficeHandler.self.get_officeParent_id(c.hierarchy,c.id);var a=0;a=b[b.length-1];if(d!=undefined&&d!=null){for(var f=0;f<d.length;f++){var e="";if(d[f].id===c.id){continue}if(d[f].id===a){e="selected"}var a=b[b.length-1];g+="<option  "+e+"  data-toggle='tooltip' data-trigger='focus' data-placement='top' title=' DESCRIPTION :  "+d[f].nameDecorated+"'   value='"+d[f].id+"' id='"+d[f].id+"' data-description='"+d[f].name+"'> "+d[f].name+" </option>"}}$("#systemOffices").html(g);$("#officeName").val(c.name);$("#office_date_opened").val(c.openingDate[2]+" "+getMonth(c.openingDate[1])+" "+c.openingDate[0]);$("#office_date_opened").prop("disabled",true);$("#updateOfficeButtom").off("click touch").on("click touch",OfficeHandler.self.handleOfficeUpdateButton);$("#back_to_offices").off("click").on("click",handlers.Settings.manage_offices);manageOfficeCreationDate=$("#office_date_opened").val();showContent($("#add_office_page"));OfficeHandler.prototype.showOfficeUpdateButtons()};OfficeHandler.prototype.handleOfficeCancelUpdateButton=function(){OfficeHandler.prototype.disableOfficeFieldsForEdit();$.each(OfficeHandler.self.get_system_offices(),function(b,a){if(a.id===OfficeHandler.self.selected_office_id){OfficeHandler.prototype.manage_office(a)}})};OfficeHandler.prototype.handleOfficeEditButton=function(){OfficeHandler.prototype.showOfficeEditButtons();OfficeHandler.prototype.enableOfficeFieldsForCreateAndEdit()};OfficeHandler.prototype.showOfficeCreationButtons=function(){$("#editOfficeButtom").hide();$("#updateOfficeButtom").hide();$("#createOfficeButtom").show();$("#back_to_offices").show();$("#cancelOfficeEditButton").hide()};OfficeHandler.prototype.disableOfficeFieldsForEdit=function(){document.getElementById("systemOffices").disabled=true;document.getElementById("officeName").disabled=true;document.getElementById("office_date_opened").disabled=true};OfficeHandler.prototype.enableOfficeFieldsForCreateAndEdit=function(){document.getElementById("systemOffices").disabled=false;document.getElementById("officeName").disabled=false;document.getElementById("office_date_opened").disabled=false};OfficeHandler.prototype.showOfficeUpdateButtons=function(){$("#editOfficeButtom").show();$("#updateOfficeButtom").hide();$("#createOfficeButtom").hide();$("#back_to_offices").show();$("#cancelOfficeEditButton").hide()};OfficeHandler.prototype.showOfficeEditButtons=function(){$("#editOfficeButtom").hide();$("#updateOfficeButtom").show();$("#createOfficeButtom").hide();$("#back_to_offices").hide();$("#cancelOfficeEditButton").show()};OfficeHandler.prototype.handleOfficeUpdateButton=function(d){d.preventDefault();if(validateForm($("#createOffficeForm"))){var e=$("#officeName").val();var h=$("#systemOffices").val();var f=manageOfficeCreationDate;if(f===null||f===""||f===undefined){showAlertMessage("Enter Date Created ",AlertTypes.warning);return}if(e===null||e===""||e===undefined||e.length===0){showAlertMessage("Enter Office Name",AlertTypes.warning);return}var b="Confirm Office Update";var g="Are you sure you want to edit this office with the provided details";var c="Yes";var a="No";showDialogPopupWithHandlers(b,g,c,function(){var i='{"name":"'+e+'"';var k=new Date(manageOfficeCreationDate);var j=k.toString("dd MMM yyyy");if(h>0){i+=',"parentId":"'+h+'"}'}var l={tenantId:getAuthenticationHeader().tenantId,authentication:getAuthenticationHeader().authentication,officeId:OfficeHandler.self.selected_office_id};$.ajax({url:host+"/offices/v1d/updateOffice/"+OfficeHandler.self.selected_office_id,data:i,dataType:"json",contentType:"application/json; charset=utf-8",headers:l,type:"POST",beforeSend:function(){showLoader()},success:function(m){document.getElementById("createOffficeForm").reset();OfficeHandler.self.init(function(){showAlertMessage("Office Updated Successfully",AlertTypes.success);hideLoader();handlers.Settings.manage_offices()})},complete:function(){hideLoader()}}).fail(function(m){if(m.status===403){showAlertMessage("Challenge from the server",AlertTypes.warning)}else{if(m.status===500){showAlertMessage("Server Not Reacheable, Check Your Internet Connectivity ",AlertTypes.danger)}else{showAlertMessage("Something went Wrong contact Administrator ",AlertTypes.danger)}}hideLoader()})},a,function(){})}else{showAlertMessage("Please ensure that all the fields are filled in correctly",AlertTypes.danger)}};