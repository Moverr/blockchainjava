var RolesHandler=function(){RolesHandler.self=this};RolesHandler.DISPLAY_ROLE_TITLES={name:"Name",description:"Description",permissions:"#Permissions"};RolesHandler.prototype.SystemRoles=null;RolesHandler.prototype.init=function(){ajax("/roles/v1d/getAllRoles/","GET",function(a){RolesHandler.self.SystemRoles=a},null,getAuthenticationHeader())};RolesHandler.prototype.get_system_roles=function(){return RolesHandler.self.SystemRoles};RolesHandler.prototype.add_role=function(){hideContent();$("#createRolePage").off("submit");$("#createRolePage").on("submit",RolesHandler.self.submitRole);$("#backtoRolesButton").off("click touch");$("#backtoRolesButton").on("click touch",RolesHandler.self.display_roles);clearFormValidators($("#createRolePage"));registerKeyPressValidators($("#createRolePage"));showContent($("#add_role_page"))};RolesHandler.prototype.selected_role;RolesHandler.prototype.manage_role=function(e){RolesHandler.self.selected_role_permissions=[];$("#permissions_list_roles_assignment").html("");RolesHandler.self.selected_role=e;hideContent();$("#view_roleName").val(e.name);$("#manage_role_page .panel-heading span").text(e.name);$("#view_roleDescription").val(e.description);var a=handlers.Permissions.get_groupings();var d="";for(var c=0;c<a.length;c++){d+="<li data-id='"+a[c].grouping+"'><a data-id='"+a[c].grouping+"' href='javascript:void(0);'>"+(a[c].grouping.replace(/_/g," ").toUpperCase())+"</a></li>"}var b=0;if(e.rolePermissions!=undefined||e.rolePermissions!=null){while(b<e.rolePermissions.length){if(e.rolePermissions[b].selected){RolesHandler.self.selected_role_permissions.push(e.rolePermissions[b].code)}b++}}$("#authorization_grouping").html(d);$("#authorization_grouping a").off("click touch");$("#authorization_grouping a").on("click touch",RolesHandler.self.display_permission_based_on_grouping);$("#submit_permissions").off("click touch");$("#submit_permissions").on("click touch",RolesHandler.self.assign_permission);$("#back_to_roles").off("click touch");$("#back_to_roles").on("click touch",RolesHandler.self.display_roles);showContent($("#permission_role_assignment"));$(".permissions_list_roles_assignment").html("")};RolesHandler.prototype.assign_permission=function(){if(RolesHandler.self.selected_role_permissions.length<0){showAlertMessage("Select Permissions to Assign to this Role",AlertTypes.warning);return}if(RolesHandler.self.selected_role_permissions.length<=0){showAlertMessage("Select Permissions",AlertTypes.warning);return}var i='{"code":"ALL_FUNCTIONS"},';var d=[{code:"ALL_FUNCTIONS",selected:true}];var f=0;do{i+='{"code":"'+RolesHandler.self.selected_role_permissions[f]+'"}';f++;if(f<RolesHandler.self.selected_role_permissions.length){i+=","}d.push({code:RolesHandler.self.selected_role_permissions[f],selected:true})}while(f<RolesHandler.self.selected_role_permissions.length);i+="";var e='{"id":"'+RolesHandler.self.selected_role.id+'","rolePermissions":['+i+"]}";headers=getAuthenticationHeader();var c=$("body");var a="Confirm Role Update";var g="Are you sure you want to update this role with the provided details";var h="Yes";var b="No";showDialogPopupWithHandlers(a,g,h,function(){$.ajax({url:host+"/roles/v1d/updateRole",data:e,dataType:"json",contentType:"application/json; charset=utf-8",headers:headers,type:"POST",beforeSend:function(){showLoader()},success:function(k){showAlertMessage("Record Saved Successfully",AlertTypes.success);hideLoader();var j=RolesHandler.self.SystemRoles;$.each(j,function(l,m){if(m.id===RolesHandler.self.selected_role.id){j[l].rolePermissions=d}});RolesHandler.self.SystemRoles=j;RolesHandler.self.resetRolesForm();RolesHandler.self.display_roles()},complete:function(){hideLoader()}}).fail(function(j){if(j.status===403){showAlertMessage("Record was not saved Correctly ",AlertTypes.warning)}else{if(j.status===500){showAlertMessage("Something went wrong, if persists contact Server Admin",AlertTypes.danger)}else{if(j.status===404){showAlertMessage("Check Your Network Connection",AlertTypes.danger)}else{showAlertMessage("Something went Wrong contact Administrator ",AlertTypes.danger)}}}hideLoader()})},b,function(){})};RolesHandler.prototype.display_permission_based_on_grouping=function(){var d=$(this).attr("data-id");$(".authorization_grouping li").removeAttr("class");$(this).closest("li").attr("class","active_list_selection");var e=handlers.Permissions.filter_permission_by_groupe(d);var f="";if(e.length>0){var a=0;do{var b="";for(var c=0;c<RolesHandler.self.selected_role_permissions.length;c++){if(e[a].code===RolesHandler.self.selected_role_permissions[c]){b="checked";break}}f+=' <div class="form-group"><div class="checkbox"><label> <input  class="check_box_permissions" '+b+' name="permission_list" value="'+e[a].code+'" type="checkbox">'+(e[a].code.replace(/_/g," ").toUpperCase())+"</label></div> </div>";a++}while(a<e.length)}$(".permissions_list_roles_assignment").html(f);$(".permissions_list_roles_assignment .check_box_permissions").on("click touch",RolesHandler.self.handle_permission_assignment)};RolesHandler.prototype.selected_role_permissions=[];RolesHandler.prototype.handle_permission_assignment=function(){var c=$(this).val();var e=RolesHandler.self.selected_role_permissions.length;var b=false;var d=0;if(e>0){b=false;var a=0;do{if(c===RolesHandler.self.selected_role_permissions[a]){b=true;d=a;break}a++}while(a<e)}if($(this).is(":checked")){if(b===false){RolesHandler.self.selected_role_permissions.push(c)}}else{if(b===true){if(d>-1){RolesHandler.self.selected_role_permissions.splice(d,1)}}}};RolesHandler.prototype.resetRolesForm=function(){$("#roleName").val("");$("#roleDescription").val("")};RolesHandler.prototype.submitRole=function(d){d.preventDefault();if(validateForm($("#createRolePage"))){var b="Confirm role creation";var e="Are you sure you want to create this role with the provided details";var c="Yes";var a="No";showDialogPopupWithHandlers(b,e,c,function(){var g=$("#roleName").val().trim();var i=$("#roleDescription").val().trim();if(g===undefined||g.length<=0||g===""||g===" "){showAlertMessage("Enter Role Name",AlertTypes.warning);return}if(i===undefined||i.length<=0||i===""||i===" "){showAlertMessage("Enter Role Description",AlertTypes.warning);return}var f='{"name":"'+g+'","description":"'+i+'"}';var j=getAuthenticationHeader();var h=$("body");$.ajax({url:host+"/roles/v1d/createRole",data:f,dataType:"json",contentType:"application/json; charset=utf-8",headers:j,type:"POST",beforeSend:function(){showLoader()},success:function(k){var l={id:k.resourceId,name:""+g,description:""+i,rolePermissions:{}};RolesHandler.self.SystemRoles.push(l);showAlertMessage("Record Saved Successfully",AlertTypes.success);hideLoader();RolesHandler.self.resetRolesForm();RolesHandler.self.manage_role(l)},complete:function(){hideLoader()}}).fail(function(k){if(k.status===403){showAlertMessage("Record not saved ",AlertTypes.warning)}else{if(k.status===404){showAlertMessage("Server Not Reacheable, Check Your Internet Connectivity ",AlertTypes.danger)}else{showAlertMessage("Something went Wrong contact Administrator ",AlertTypes.danger)}}hideLoader()})},a,function(){})}else{showAlertMessage("Please ensure all the fields are filled in correctly.",AlertTypes.warning)}};RolesHandler.prototype.display_roles=function(){RolesHandler.self.currentClient=null;initDefaultContent("System Roles ");$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").on("click touch",printData);$("#printableTitle").text("Roles");$("#printNow").show();$("#create_object").off("click touch");$("#create_object").text("Create Role ");$("#create_object").on("click touch",RolesHandler.self.add_role);$("#create_object").show();var f=RolesHandler.self.SystemRoles;var j=getDefaultRowContainer(RolesHandler.DISPLAY_ROLE_TITLES,true);var h=j.parent();if(f.length>0){for(var d=0;d<f.length;d++){var k={};var c=f[d];k.name=c.name;k.description=c.description;var a=0;var l=0;if(c.rolePermissions!=undefined||c.rolePermissions!=null){while(l<c.rolePermissions.length){if(c.rolePermissions[l].selected){a++}l++}}k.num_permissions=a;addRow(j,k,f[d],RolesHandler.self.rowClickHandler,f[d])}}var e=getDefaultTableSorter();e.headers={3:{sorter:"awamoDateSorter"},4:{sorter:"awamoDateSorter"}};initialize_datatable(h);var b=document.getElementById("defaultTableContainer").getElementsByTagName("table");for(var d=0;d<b.length;d++){b[d].style.textAlign="right"}$("#tableTotal").text(f.length);showContent($("#tableTotalSum"));showContent($("#emailLoanReportDiv"));var g=$("#defaultTableContainer").tableExport();g.tableExport.update({formats:["xls","xlsx"],fileName:"System_roles"+(new Date().toJSON().slice(0,10).replace(/-/g,"_")),headings:true});$("#hiddenPrintedTitle").val("Users Report")};RolesHandler.prototype.rowClickHandler=function(){clearExportButtons();$("#syncNow").off("click touch");$("#syncNow").attr("title","Nothing to sync");$("#printNow").off("click touch");$("#printNow").hide();RolesHandler.self.manage_role($(this).data("object"))};